"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _db = _interopRequireDefault(require("../db"));

var _types = require("../types");

var _utils = require("../utils");

var _debug = _interopRequireDefault(require("debug"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _toArray(arr) { return _arrayWithHoles(arr) || _iterableToArray(arr) || _nonIterableRest(); }

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance"); }

function _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === "[object Arguments]") return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var debug = (0, _debug.default)('funfunzmc:controller-table');

var TableController =
/*#__PURE__*/
function () {
  function TableController() {
    _classCallCheck(this, TableController);

    debug('Created');
  }

  _createClass(TableController, [{
    key: "getTableConfig",
    value: function getTableConfig(req, res, next) {
      var TABLE_CONFIG = (0, _utils.getTableConfig)(req.params.table);
      var RESULT = {
        columns: TABLE_CONFIG.columns,
        name: TABLE_CONFIG.name,
        pk: TABLE_CONFIG.pk,
        verbose: TABLE_CONFIG.verbose
      };

      if ((0, _utils.hasAuthorization)(TABLE_CONFIG.roles, req.user)) {
        (0, _utils.addToResponse)(res, 'results')(RESULT);
        return (0, _utils.nextAndReturn)(next)(RESULT);
      } else {
        return (0, _utils.catchMiddleware)(next)(new _types.HttpException(401, 'Not authorized'));
      }
    }
  }, {
    key: "getTableData",
    value: function getTableData(req, res, next) {
      var PAGE_NUMBER = req.query.page || 0;
      var TABLE_NAME = req.params.table;
      var TABLE_CONFIG = (0, _utils.getTableConfig)(TABLE_NAME);
      var COLUMNS = (0, _utils.filterVisibleTableColumns)(TABLE_CONFIG, 'main');
      var LIMIT = 10;

      if (req.query.limit) {
        LIMIT = parseInt(req.query.limit, 10);
      }

      if (!(0, _utils.hasAuthorization)(TABLE_CONFIG.roles, req.user)) {
        return (0, _utils.catchMiddleware)(next)(new _types.HttpException(401, 'Not authorized'));
      }

      if (!_db.default.db) {
        return (0, _utils.catchMiddleware)(next)(new _types.HttpException(500, 'No database'));
      }

      var DB = _db.default.db;
      var QUERY = DB.select(COLUMNS).from(TABLE_NAME);

      if (req.query.filter) {
        QUERY = (0, _utils.applyQueryFilters)(QUERY, req.query.filter, TABLE_CONFIG);
      }

      return QUERY.offset(PAGE_NUMBER * LIMIT).limit(LIMIT).then(function (results) {
        var toRequest = {};
        var COLUMNS_WITH_RELATIONS = TABLE_CONFIG.columns.filter(function (column) {
          return column.relation;
        });
        results.forEach(function (row, index) {
          COLUMNS_WITH_RELATIONS.forEach(function (column) {
            if (!column.relation) {
              throw new _types.HttpException(500, 'Column should have a relation');
            }

            var RELATION = column.relation;
            var RELATION_TABLE_NAME = RELATION.table;
            var ROW_RELATION_VALUE = row[column.name];

            if (!toRequest[RELATION_TABLE_NAME]) {
              toRequest[RELATION_TABLE_NAME] = {
                values: {},
                key: RELATION.key,
                display: RELATION.display,
                foreignKeyColumn: column.name
              };
            }

            if (toRequest[RELATION_TABLE_NAME].values[ROW_RELATION_VALUE] === undefined) {
              toRequest[RELATION_TABLE_NAME].values = _objectSpread({}, toRequest[RELATION_TABLE_NAME].values, _defineProperty({}, ROW_RELATION_VALUE, index));
            }
          });
        });
        var relationQueries = [];
        Object.keys(toRequest).forEach(function (tableName) {
          relationQueries.push(DB.select(toRequest[tableName].display, toRequest[tableName].key).from(tableName).whereIn(toRequest[tableName].key, Object.keys(toRequest[tableName].values)));
        });
        return Promise.all([results, toRequest, Promise.all(relationQueries)]);
      }).then(function (_ref) {
        var _ref2 = _slicedToArray(_ref, 3),
            results = _ref2[0],
            toRequest = _ref2[1],
            relationResults = _ref2[2];

        var MATCHER = {};
        Object.values(toRequest).forEach(function (requestedTable, index) {
          var FOREIGN_KEY_COLUMN = requestedTable.foreignKeyColumn;
          MATCHER[FOREIGN_KEY_COLUMN] = {};
          relationResults[index].forEach(function (relationRow) {
            var CURRENT_VALUE = relationRow[requestedTable.key];
            var VALUE_TO_DISPLAY = relationRow[requestedTable.display];
            MATCHER[FOREIGN_KEY_COLUMN][CURRENT_VALUE] = VALUE_TO_DISPLAY;
          });
        });
        return results.map(function (row) {
          Object.values(toRequest).forEach(function (requestedTable) {
            var ROW_KEY = requestedTable.foreignKeyColumn;
            row[ROW_KEY] = MATCHER[ROW_KEY][row[ROW_KEY]];
          });
          return row;
        });
      }).then(function (results) {
        return (0, _utils.runHook)(TABLE_CONFIG, 'getTableData', 'after', req, res, _db.default.db, results);
      }).then((0, _utils.addToResponse)(res, 'results')).then((0, _utils.nextAndReturn)(next));
    }
  }, {
    key: "getTableCount",
    value: function getTableCount(req, res, next) {
      var TABLE_NAME = req.params.table;
      var TABLE_CONFIG = (0, _utils.getTableConfig)(TABLE_NAME);

      if (!(0, _utils.hasAuthorization)(TABLE_CONFIG.roles, req.user)) {
        return (0, _utils.catchMiddleware)(next)(new _types.HttpException(401, 'Not authorized'));
      } else {
        if (!_db.default.db) {
          return (0, _utils.catchMiddleware)(next)(new _types.HttpException(500, 'No database'));
        } else {
          return _db.default.db.select('*').from(TABLE_NAME).then(function (results) {
            (0, _utils.runHook)(TABLE_CONFIG, 'getTableCount', 'after', req, res, _db.default.db, results).then((0, _utils.addToResponse)(res, 'count')).then((0, _utils.nextAndReturn)(next));
          });
        }
      }
    }
  }, {
    key: "getRow",
    value: function getRow(req, res, next) {
      var _this = this;

      var TABLE_NAME = req.params.table;
      var TABLE_CONFIG = (0, _utils.getTableConfig)(TABLE_NAME);

      if (!(0, _utils.hasAuthorization)(TABLE_CONFIG.roles, req.user)) {
        return (0, _utils.catchMiddleware)(next)(new _types.HttpException(401, 'Not authorized'));
      } else {
        if (!_db.default.db) {
          return (0, _utils.catchMiddleware)(next)(new _types.HttpException(500, 'No database'));
        } else {
          var requestedColumns = (0, _utils.filterVisibleTableColumns)(TABLE_CONFIG, 'detail');

          var query = _db.default.db.select(requestedColumns).from("".concat(req.params.table)).where("id", req.params.id);

          return query.then(function (results) {
            var relationQueries = [];

            if (req.query.includeRelations) {
              relationQueries = _this.getRelationQueries(TABLE_CONFIG, results[0].id);
            }

            if (relationQueries.length) {
              return Promise.all([results[0]].concat(_toConsumableArray(relationQueries)));
            }

            return Promise.all([results[0]]);
          }).then(this.mergeRelatedData).then((0, _utils.addToResponse)(res, 'result')).then((0, _utils.nextAndReturn)(next));
        }
      }
    }
  }, {
    key: "insertRow",
    value: function insertRow(req, res, next) {
      if (!_db.default.db) {
        return (0, _utils.catchMiddleware)(next)(new _types.HttpException(500, 'No database'));
      } else {
        return _db.default.db(req.params.table).insert(req.body.data).then((0, _utils.addToResponse)(res, 'results')).then((0, _utils.nextAndReturn)(next));
      }
    }
  }, {
    key: "updateRow",
    value: function updateRow(req, res, next) {
      if (!_db.default.db) {
        return (0, _utils.catchMiddleware)(next)(new _types.HttpException(500, 'No database'));
      } else {
        return _db.default.db(req.body.table).where('id', req.body.id).update(req.body.data).then((0, _utils.addToResponse)(res, 'results')).then((0, _utils.nextAndReturn)(next));
      }
    }
  }, {
    key: "deleteRow",
    value: function deleteRow(req, res, next) {
      if (!_db.default.db) {
        return (0, _utils.catchMiddleware)(next)(new _types.HttpException(500, 'No database'));
      } else {
        return _db.default.db(req.params.table).where('id', req.params.id).del().then((0, _utils.addToResponse)(res, 'results')).then((0, _utils.nextAndReturn)(next));
      }
    }
  }, {
    key: "getRelationQueries",
    value: function getRelationQueries(TABLE_CONFIG, parentId) {
      var _this2 = this;

      var relationQueries = [];

      if (TABLE_CONFIG.relations && TABLE_CONFIG.relations.manyToOne) {
        var MANY_TO_ONE = TABLE_CONFIG.relations.manyToOne;
        var KEYS = Object.keys(MANY_TO_ONE);
        KEYS.forEach(function (tableName) {
          relationQueries.push(_this2.getRelatedRow(tableName, MANY_TO_ONE[tableName], parentId));
        });
      }

      return relationQueries;
    }
  }, {
    key: "getRelatedRow",
    value: function getRelatedRow(tableName, columnName, parentId) {
      if (!_db.default.db) {
        throw new _types.HttpException(500, 'No database');
      }

      var TABLE_NAME = tableName;
      var TABLE_CONFIG = (0, _utils.getTableConfig)(TABLE_NAME);
      var requestedColumns = (0, _utils.filterVisibleTableColumns)(TABLE_CONFIG, 'detail');
      return _db.default.db.select(requestedColumns).from(tableName).where(columnName, parentId).then(function (results) {
        return {
          results: results,
          tableName: tableName
        };
      });
    }
  }, {
    key: "mergeRelatedData",
    value: function mergeRelatedData(_ref3) {
      var _ref4 = _toArray(_ref3),
          results = _ref4[0],
          relations = _ref4.slice(1);

      if (relations && relations.length) {
        relations.forEach(function (relation) {
          results[relation.tableName] = relation.results;
        });
      }

      return results;
    }
  }]);

  return TableController;
}();

var _default = TableController;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcGkvY29udHJvbGxlcnMvVGFibGVDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbImRlYnVnIiwiVGFibGVDb250cm9sbGVyIiwicmVxIiwicmVzIiwibmV4dCIsIlRBQkxFX0NPTkZJRyIsInBhcmFtcyIsInRhYmxlIiwiUkVTVUxUIiwiY29sdW1ucyIsIm5hbWUiLCJwayIsInZlcmJvc2UiLCJyb2xlcyIsInVzZXIiLCJIdHRwRXhjZXB0aW9uIiwiUEFHRV9OVU1CRVIiLCJxdWVyeSIsInBhZ2UiLCJUQUJMRV9OQU1FIiwiQ09MVU1OUyIsIkxJTUlUIiwibGltaXQiLCJwYXJzZUludCIsImRhdGFiYXNlIiwiZGIiLCJEQiIsIlFVRVJZIiwic2VsZWN0IiwiZnJvbSIsImZpbHRlciIsIm9mZnNldCIsInRoZW4iLCJyZXN1bHRzIiwidG9SZXF1ZXN0IiwiQ09MVU1OU19XSVRIX1JFTEFUSU9OUyIsImNvbHVtbiIsInJlbGF0aW9uIiwiZm9yRWFjaCIsInJvdyIsImluZGV4IiwiUkVMQVRJT04iLCJSRUxBVElPTl9UQUJMRV9OQU1FIiwiUk9XX1JFTEFUSU9OX1ZBTFVFIiwidmFsdWVzIiwia2V5IiwiZGlzcGxheSIsImZvcmVpZ25LZXlDb2x1bW4iLCJ1bmRlZmluZWQiLCJyZWxhdGlvblF1ZXJpZXMiLCJPYmplY3QiLCJrZXlzIiwidGFibGVOYW1lIiwicHVzaCIsIndoZXJlSW4iLCJQcm9taXNlIiwiYWxsIiwicmVsYXRpb25SZXN1bHRzIiwiTUFUQ0hFUiIsInJlcXVlc3RlZFRhYmxlIiwiRk9SRUlHTl9LRVlfQ09MVU1OIiwicmVsYXRpb25Sb3ciLCJDVVJSRU5UX1ZBTFVFIiwiVkFMVUVfVE9fRElTUExBWSIsIm1hcCIsIlJPV19LRVkiLCJyZXF1ZXN0ZWRDb2x1bW5zIiwid2hlcmUiLCJpZCIsImluY2x1ZGVSZWxhdGlvbnMiLCJnZXRSZWxhdGlvblF1ZXJpZXMiLCJsZW5ndGgiLCJtZXJnZVJlbGF0ZWREYXRhIiwiaW5zZXJ0IiwiYm9keSIsImRhdGEiLCJ1cGRhdGUiLCJkZWwiLCJwYXJlbnRJZCIsInJlbGF0aW9ucyIsIm1hbnlUb09uZSIsIk1BTllfVE9fT05FIiwiS0VZUyIsImdldFJlbGF0ZWRSb3ciLCJjb2x1bW5OYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBWUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBSUEsSUFBTUEsS0FBSyxHQUFHLG9CQUFNLDRCQUFOLENBQWQ7O0lBYU1DLGU7OztBQUNKLDZCQUFjO0FBQUE7O0FBQ1pELElBQUFBLEtBQUssQ0FBQyxTQUFELENBQUw7QUFDRDs7OzttQ0FFcUJFLEcsRUFBaUJDLEcsRUFBa0JDLEksRUFBb0I7QUFDM0UsVUFBTUMsWUFBWSxHQUFHLDJCQUFlSCxHQUFHLENBQUNJLE1BQUosQ0FBV0MsS0FBMUIsQ0FBckI7QUFDQSxVQUFNQyxNQUFNLEdBQUc7QUFDYkMsUUFBQUEsT0FBTyxFQUFFSixZQUFZLENBQUNJLE9BRFQ7QUFFYkMsUUFBQUEsSUFBSSxFQUFFTCxZQUFZLENBQUNLLElBRk47QUFHYkMsUUFBQUEsRUFBRSxFQUFFTixZQUFZLENBQUNNLEVBSEo7QUFJYkMsUUFBQUEsT0FBTyxFQUFFUCxZQUFZLENBQUNPO0FBSlQsT0FBZjs7QUFPQSxVQUFJLDZCQUFpQlAsWUFBWSxDQUFDUSxLQUE5QixFQUFxQ1gsR0FBRyxDQUFDWSxJQUF6QyxDQUFKLEVBQW9EO0FBQ2xELGtDQUFjWCxHQUFkLEVBQW1CLFNBQW5CLEVBQThCSyxNQUE5QjtBQUNBLGVBQU8sMEJBQWNKLElBQWQsRUFBb0JJLE1BQXBCLENBQVA7QUFDRCxPQUhELE1BR087QUFDTCxlQUFPLDRCQUFnQkosSUFBaEIsRUFBc0IsSUFBSVcsb0JBQUosQ0FBa0IsR0FBbEIsRUFBdUIsZ0JBQXZCLENBQXRCLENBQVA7QUFDRDtBQUNGOzs7aUNBRW1CYixHLEVBQWlCQyxHLEVBQWtCQyxJLEVBQW9CO0FBQ3pFLFVBQU1ZLFdBQVcsR0FBR2QsR0FBRyxDQUFD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REY7QUFPRCxTQVRIO0FBV0Q7O0FBRUQsYUFBTzdCLGVBQVA7QUFDRDs7O2tDQUVxQkcsUyxFQUFtQmdDLFUsRUFBb0JOLFEsRUFBZTtBQUMxRSxVQUFJLENBQUN0RCxZQUFTQyxFQUFkLEVBQWtCO0FBQ2hCLGNBQU0sSUFBSVYsb0JBQUosQ0FBa0IsR0FBbEIsRUFBdUIsYUFBdkIsQ0FBTjtBQUNEOztBQUNELFVBQU1JLFVBQVUsR0FBR2lDLFNBQW5CO0FBQ0EsVUFBTS9DLFlBQVksR0FBRywyQkFBZWMsVUFBZixDQUFyQjtBQUVBLFVBQU0rQyxnQkFBZ0IsR0FBRyxzQ0FBMEI3RCxZQUExQixFQUF3QyxRQUF4QyxDQUF6QjtBQUNBLGFBQU9tQixZQUFTQyxFQUFULENBQVlHLE1BQVosQ0FBbUJzQyxnQkFBbkIsRUFDSnJDLElBREksQ0FDQ3VCLFNBREQsRUFFSmUsS0FGSSxDQUVFaUIsVUFGRixFQUVjTixRQUZkLEVBRXdCOUMsSUFGeEIsQ0FHSCxVQUFDQyxPQUFEO0FBQUEsZUFBYztBQUNaQSxVQUFBQSxPQUFPLEVBQVBBLE9BRFk7QUFFWm1CLFVBQUFBLFNBQVMsRUFBVEE7QUFGWSxTQUFkO0FBQUEsT0FIRyxDQUFQO0FBUUQ7Ozs0Q0FFc0Q7QUFBQTtBQUFBLFVBQTdCbkIsT0FBNkI7QUFBQSxVQUFqQjhDLFNBQWlCOztBQUNyRCxVQUFJQSxTQUFTLElBQUlBLFNBQVMsQ0FBQ1IsTUFBM0IsRUFBbUM7QUFDakNRLFFBQUFBLFNBQVMsQ0FBQ3pDLE9BQVYsQ0FDRSxVQUFDRCxRQUFELEVBQW1EO0FBQ2pESixVQUFBQSxPQUFPLENBQUNJLFFBQVEsQ0FBQ2UsU0FBVixDQUFQLEdBQThCZixRQUFRLENBQUNKLE9BQXZDO0FBQ0QsU0FISDtBQUtEOztBQUVELGFBQU9BLE9BQVA7QUFDRDs7Ozs7O2VBR1loQyxlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGRhdGFiYXNlIGZyb20gJ0Byb290L2FwaS9kYidcbmltcG9ydCB7IEh0dHBFeGNlcHRpb24sIElNQ1JlcXVlc3QsIElNQ1Jlc3BvbnNlIH0gZnJvbSAnQHJvb3QvYXBpL3R5cGVzJ1xuaW1wb3J0IHtcbiAgYWRkVG9SZXNwb25zZSxcbiAgYXBwbHlRdWVyeUZpbHRlcnMsXG4gIGNhdGNoTWlkZGxld2FyZSxcbiAgZmlsdGVyVmlzaWJsZVRhYmxlQ29sdW1ucyxcbiAgZ2V0VGFibGVDb25maWcsXG4gIGhhc0F1dGhvcml6YXRpb24sXG4gIG5leHRBbmRSZXR1cm4sXG4gIHJ1bkhvb2tcbn0gZnJvbSAnQHJvb3QvYXBpL3V0aWxzJ1xuaW1wb3J0IHsgSVRhYmxlSW5mbyB9IGZyb20gJ0Byb290L2NvbmZpZ0dlbmVyYXRvcidcbmltcG9ydCBCbHVlYmlyZCBmcm9tICdibHVlYmlyZCdcbmltcG9ydCBEZWJ1ZyBmcm9tICdkZWJ1ZydcbmltcG9ydCB7IE5leHRGdW5jdGlvbiwgUmVxdWVzdCB9IGZyb20gJ2V4cHJlc3MnXG5pbXBvcnQgS25leCBmcm9tICdLbmV4J1xuXG5jb25zdCBkZWJ1ZyA9IERlYnVnKCdmdW5mdW56bWM6Y29udHJvbGxlci10YWJsZScpXG5cbmludGVyZmFjZSBJVG9SZXF1ZXN0IHtcbiAgW2tleTogc3RyaW5nXToge1xuICAgIHZhbHVlczoge1xuICAgICAgW2tleTogc3RyaW5nXTogdHJ1ZSxcbiAgICB9LFxuICAgIGtleTogc3RyaW5nLFxuICAgIGRpc3BsYXk6IHN0cmluZyxcbiAgICBmb3JlaWduS2V5Q29sdW1uOiBzdHJpbmdcbiAgfSxcbn1cblxuY2xhc3MgVGFibGVDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgZGVidWcoJ0NyZWF0ZWQnKVxuICB9XG5cbiAgcHVibGljIGdldFRhYmxlQ29uZmlnKHJlcTogSU1DUmVxdWVzdCwgcmVzOiBJTUNSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSB7XG4gICAgY29uc3QgVEFCTEVfQ09ORklHID0gZ2V0VGFibGVDb25maWcocmVxLnBhcmFtcy50YWJsZSlcbiAgICBjb25zdCBSRVNVTFQgPSB7XG4gICAgICBjb2x1bW5zOiBUQUJMRV9DT05GSUcuY29sdW1ucyxcbiAgICAgIG5hbWU6IFRBQkxFX0NPTkZJRy5uYW1lLFxuICAgICAgcGs6IFRBQkxFX0NPTkZJRy5wayxcbiAgICAgIHZlcmJvc2U6IFRBQkxFX0NPTkZJRy52ZXJib3NlLFxuICAgIH1cblxuICAgIGlmIChoYXNBdXRob3JpemF0aW9uKFRBQkxFX0NPTkZJRy5yb2xlcywgcmVxLnVzZXIpKSB7XG4gICAgICBhZGRUb1Jlc3BvbnNlKHJlcywgJ3Jlc3VsdHMnKShSRVNVTFQpXG4gICAgICByZXR1cm4gbmV4dEFuZFJldHVybihuZXh0KShSRVNVTFQpXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBjYXRjaE1pZGRsZXdhcmUobmV4dCkobmV3IEh0dHBFeGNlcHRpb24oNDAxLCAnTm90IGF1dGhvcml6ZWQnKSlcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZ2V0VGFibGVEYXRhKHJlcTogSU1DUmVxdWVzdCwgcmVzOiBJTUNSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSB7XG4gICAgY29uc3QgUEFHRV9OVU1CRVIgPSByZXEucXVlcnkucGFnZSB8fCAwXG4gICAgY29uc3QgVEFCTEVfTkFNRSA9IHJlcS5wYXJhbXMudGFibGVcbiAgICBjb25zdCBUQUJMRV9DT05GSUcgPSBnZXRUYWJsZUNvbmZpZyhUQUJMRV9OQU1FKVxuICAgIGNvbnN0IENPTFVNTlMgPSBmaWx0ZXJWaXNpYmxlVGFibGVDb2x1bW5zKFRBQkxFX0NPTkZJRywgJ21haW4nKVxuICAgIGxldCBMSU1JVCA9IDEwXG5cbiAgICBpZiAocmVxLnF1ZXJ5LmxpbWl0KSB7XG4gICAgICBMSU1JVCA9IHBhcnNlSW50KHJlcS5xdWVyeS5saW1pdCwgMTApXG4gICAgfVxuXG4gICAgaWYgKCFoYXNBdXRob3JpemF0aW9uKFRBQkxFX0NPTkZJRy5yb2xlcywgcmVxLnVzZXIpKSB7XG4gICAgICByZXR1cm4gY2F0Y2hNaWRkbGV3YXJlKG5leHQpKG5ldyBIdHRwRXhjZXB0aW9uKDQwMSwgJ05vdCBhdXRob3JpemVkJykpXG4gICAgfVxuICAgIGlmICghZGF0YWJhc2UuZGIpIHtcbiAgICAgIHJldHVybiBjYXRjaE1pZGRsZXdhcmUobmV4dCkobmV3IEh0dHBFeGNlcHRpb24oNTAwLCAnTm8gZGF0YWJhc2UnKSlcbiAgICB9XG4gICAgY29uc3QgREIgPSBkYXRhYmFzZS5kYlxuICAgIGxldCBRVUVSWSA9IERCLnNlbGVjdChDT0xVTU5TKS5mcm9tKFRBQkxFX05BTUUpXG4gICAgaWYgKHJlcS5xdWVyeS5maWx0ZXIpIHtcbiAgICAgIFFVRVJZID0gYXBwbHlRdWVyeUZpbHRlcnMoUVVFUlksIHJlcS5xdWVyeS5maWx0ZXIsIFRBQkxFX0NPTkZJRylcbiAgICB9XG4gICAgcmV0dXJuIFFVRVJZXG4gICAgICAub2Zmc2V0KChQQUdFX05VTUJFUikgKiBMSU1JVClcbiAgICAgIC5saW1pdChMSU1JVClcbiAgICAgIC50aGVuKFxuICAgICAgKHJlc3VsdHMpID0+IHtcbiAgICAgICAgY29uc3QgdG9SZXF1ZXN0OiBJVG9SZXF1ZXN0ID0ge31cbiAgICAgICAgY29uc3QgQ09MVU1OU19XSVRIX1JFTEFUSU9OUyA9IFRBQkxFX0NPTkZJRy5jb2x1bW5zLmZpbHRlcihcbiAgICAgICAgICAoY29sdW1uKSA9PiBjb2x1bW4ucmVsYXRpb25cbiAgICAgICAgKVxuICAgICAgICByZXN1bHRzLmZvckVhY2goXG4gICAgICAgICAgKHJvdzogYW55LCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgICBDT0xVTU5TX1dJVEhfUkVMQVRJT05TLmZvckVhY2goXG4gICAgICAgICAgICAgIChjb2x1bW4pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWNvbHVtbi5yZWxhdGlvbikge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oNTAwLCAnQ29sdW1uIHNob3VsZCBoYXZlIGEgcmVsYXRpb24nKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBSRUxBVElPTiA9IGNvbHVtbi5yZWxhdGlvblxuICAgICAgICAgICAgICAgIGNvbnN0IFJFTEFUSU9OX1RBQkxFX05BTUUgPSBSRUxBVElPTi50YWJsZVxuICAgICAgICAgICAgICAgIGNvbnN0IFJPV19SRUxBVElPTl9WQUxVRSA9IHJvd1tjb2x1bW4ubmFtZV1cblxuICAgICAgICAgICAgICAgIGlmICghdG9SZXF1ZXN0W1JFTEFUSU9OX1RBQkxFX05BTUVdKSB7XG4gICAgICAgICAgICAgICAgICB0b1JlcXVlc3RbUkVMQVRJT05fVEFCTEVfTkFNRV0gPSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlczoge30sXG4gICAgICAgICAgICAgICAgICAgIGtleTogUkVMQVRJT04ua2V5LFxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBSRUxBVElPTi5kaXNwbGF5LFxuICAgICAgICAgICAgICAgICAgICBmb3JlaWduS2V5Q29sdW1uOiBjb2x1bW4ubmFtZSxcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodG9SZXF1ZXN0W1JFTEFUSU9OX1RBQkxFX05BTUVdLnZhbHVlc1tST1dfUkVMQVRJT05fVkFMVUVdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgIHRvUmVxdWVzdFtSRUxBVElPTl9UQUJMRV9OQU1FXS52YWx1ZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnRvUmVxdWVzdFtSRUxBVElPTl9UQUJMRV9OQU1FXS52YWx1ZXMsXG4gICAgICAgICAgICAgICAgICAgIFtST1dfUkVMQVRJT05fVkFMVUVdOiBpbmRleCxcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgICB9XG4gICAgICAgIClcblxuICAgICAgICBjb25zdCByZWxhdGlvblF1ZXJpZXM6IEtuZXguUXVlcnlCdWlsZGVyW10gPSBbXVxuICAgICAgICBPYmplY3Qua2V5cyh0b1JlcXVlc3QpLmZvckVhY2goXG4gICAgICAgICAgKHRhYmxlTmFtZSkgPT4ge1xuICAgICAgICAgICAgcmVsYXRpb25RdWVyaWVzLnB1c2goXG4gICAgICAgICAgICAgIERCLnNlbGVjdCh0b1JlcXVlc3RbdGFibGVOYW1lXS5kaXNwbGF5LCB0b1JlcXVlc3RbdGFibGVOYW1lXS5rZXkpXG4gICAgICAgICAgICAgICAgLmZyb20odGFibGVOYW1lKVxuICAgICAgICAgICAgICAgIC53aGVyZUluKHRvUmVxdWVzdFt0YWJsZU5hbWVdLmtleSwgT2JqZWN0LmtleXModG9SZXF1ZXN0W3RhYmxlTmFtZV0udmFsdWVzKSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICB9XG4gICAgICAgIClcblxuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGw8YW55W10sIElUb1JlcXVlc3QsIGFueVtdW10+KFtyZXN1bHRzLCB0b1JlcXVlc3QsIFByb21pc2UuYWxsKHJlbGF0aW9uUXVlcmllcyldKVxuICAgICAgfVxuICAgICkudGhlbihcbiAgICAgIChbcmVzdWx0cywgdG9SZXF1ZXN0LCByZWxhdGlvblJlc3VsdHNdKSA9PiB7XG4gICAgICAgIGNvbnN0IE1BVENIRVI6IHtcbiAgICAgICAgICBbZm9yZWlnbktleUNvbHVtbjogc3RyaW5nXToge1xuICAgICAgICAgICAgW3ZhbHVlOiBzdHJpbmddOiBzdHJpbmdcbiAgICAgICAgICB9XG4gICAgICAgIH0gPSB7fVxuICAgICAgICBPYmplY3QudmFsdWVzKHRvUmVxdWVzdCkuZm9yRWFjaChcbiAgICAgICAgICAocmVxdWVzdGVkVGFibGUsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBGT1JFSUdOX0tFWV9DT0xVTU4gPSByZXF1ZXN0ZWRUYWJsZS5mb3JlaWduS2V5Q29sdW1uXG4gICAgICAgICAgICBNQVRDSEVSW0ZPUkVJR05fS0VZX0NPTFVNTl0gPSB7fVxuICAgICAgICAgICAgcmVsYXRpb25SZXN1bHRzW2luZGV4XS5mb3JFYWNoKFxuICAgICAgICAgICAgICAocmVsYXRpb25Sb3c6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IENVUlJFTlRfVkFMVUUgPSByZWxhdGlvblJvd1tyZXF1ZXN0ZWRUYWJsZS5rZXldXG4gICAgICAgICAgICAgICAgY29uc3QgVkFMVUVfVE9fRElTUExBWSA9IHJlbGF0aW9uUm93W3JlcXVlc3RlZFRhYmxlLmRpc3BsYXldXG4gICAgICAgICAgICAgICAgTUFUQ0hFUltGT1JFSUdOX0tFWV9DT0xVTU5dW0NVUlJFTlRfVkFMVUVdID0gVkFMVUVfVE9fRElTUExBWVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApXG4gICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgIHJldHVybiByZXN1bHRzLm1hcChcbiAgICAgICAgICAocm93OiBhbnkpID0+IHtcbiAgICAgICAgICAgIE9iamVjdC52YWx1ZXModG9SZXF1ZXN0KS5mb3JFYWNoKFxuICAgICAgICAgICAgICAocmVxdWVzdGVkVGFibGUpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBST1dfS0VZID0gcmVxdWVzdGVkVGFibGUuZm9yZWlnbktleUNvbHVtblxuICAgICAgICAgICAgICAgIHJvd1tST1dfS0VZXSA9IE1BVENIRVJbUk9XX0tFWV1bcm93W1JPV19LRVldXVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApXG4gICAgICAgICAgICByZXR1cm4gcm93XG4gICAgICAgICAgfVxuICAgICAgICApXG4gICAgICB9XG4gICAgKS50aGVuKFxuICAgICAgKHJlc3VsdHMpID0+IHtcbiAgICAgICAgcmV0dXJuIHJ1bkhvb2soVEFCTEVfQ09ORklHLCAnZ2V0VGFibGVEYXRhJywgJ2FmdGVyJywgcmVxLCByZXMsIGRhdGFiYXNlLmRiLCByZXN1bHRzKVxuICAgICAgfVxuICAgICkudGhlbihcbiAgICAgIGFkZFRvUmVzcG9uc2UocmVzLCAncmVzdWx0cycpXG4gICAgKS50aGVuKFxuICAgICAgbmV4dEFuZFJldHVybihuZXh0KVxuICAgIClcbiAgfVxuXG4gIHB1YmxpYyBnZXRUYWJsZUNvdW50KHJlcTogSU1DUmVxdWVzdCwgcmVzOiBJTUNSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSB7XG4gICAgY29uc3QgVEFCTEVfTkFNRSA9IHJlcS5wYXJhbXMudGFibGVcbiAgICBjb25zdCBUQUJMRV9DT05GSUcgPSBnZXRUYWJsZUNvbmZpZyhUQUJMRV9OQU1FKVxuXG4gICAgaWYgKCFoYXNBdXRob3JpemF0aW9uKFRBQkxFX0NPTkZJRy5yb2xlcywgcmVxLnVzZXIpKSB7XG4gICAgICByZXR1cm4gY2F0Y2hNaWRkbGV3YXJlKG5leHQpKG5ldyBIdHRwRXhjZXB0aW9uKDQwMSwgJ05vdCBhdXRob3JpemVkJykpXG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghZGF0YWJhc2UuZGIpIHtcbiAgICAgICAgcmV0dXJuIGNhdGNoTWlkZGxld2FyZShuZXh0KShuZXcgSHR0cEV4Y2VwdGlvbig1MDAsICdObyBkYXRhYmFzZScpKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGRhdGFiYXNlLmRiLnNlbGVjdCgnKicpLmZyb20oVEFCTEVfTkFNRSkudGhlbihcbiAgICAgICAgICAocmVzdWx0cykgPT4ge1xuICAgICAgICAgICAgcnVuSG9vayhUQUJMRV9DT05GSUcsICdnZXRUYWJsZUNvdW50JywgJ2FmdGVyJywgcmVxLCByZXMsIGRhdGFiYXNlLmRiLCByZXN1bHRzKS50aGVuKFxuICAgICAgICAgICAgICBhZGRUb1Jlc3BvbnNlKHJlcywgJ2NvdW50JylcbiAgICAgICAgICAgICkudGhlbihcbiAgICAgICAgICAgICAgbmV4dEFuZFJldHVybihuZXh0KVxuICAgICAgICAgICAgKVxuICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBnZXRSb3cocmVxOiBJTUNSZXF1ZXN0LCByZXM6IElNQ1Jlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pIHtcbiAgICBjb25zdCBUQUJMRV9OQU1FID0gcmVxLnBhcmFtcy50YWJsZVxuICAgIGNvbnN0IFRBQkxFX0NPTkZJRyA9IGdldFRhYmxlQ29uZmlnKFRBQkxFX05BTUUpXG5cbiAgICBpZiAoIWhhc0F1dGhvcml6YXRpb24oVEFCTEVfQ09ORklHLnJvbGVzLCByZXEudXNlcikpIHtcbiAgICAgIHJldHVybiBjYXRjaE1pZGRsZXdhcmUobmV4dCkobmV3IEh0dHBFeGNlcHRpb24oNDAxLCAnTm90IGF1dGhvcml6ZWQnKSlcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCFkYXRhYmFzZS5kYikge1xuICAgICAgICByZXR1cm4gY2F0Y2hNaWRkbGV3YXJlKG5leHQpKG5ldyBIdHRwRXhjZXB0aW9uKDUwMCwgJ05vIGRhdGFiYXNlJykpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCByZXF1ZXN0ZWRDb2x1bW5zID0gZmlsdGVyVmlzaWJsZVRhYmxlQ29sdW1ucyhUQUJMRV9DT05GSUcsICdkZXRhaWwnKVxuXG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gZGF0YWJhc2UuZGIuc2VsZWN0KHJlcXVlc3RlZENvbHVtbnMpXG4gICAgICAgICAgLmZyb20oYCR7cmVxLnBhcmFtcy50YWJsZX1gKVxuICAgICAgICAgIC53aGVyZShgaWRgLCByZXEucGFyYW1zLmlkKVxuXG4gICAgICAgIHJldHVybiBxdWVyeS50aGVuKFxuICAgICAgICAgIChyZXN1bHRzKSA9PiB7XG4gICAgICAgICAgICBsZXQgcmVsYXRpb25RdWVyaWVzOiBBcnJheTxCbHVlYmlyZDx7fT4+ID0gW11cbiAgICAgICAgICAgIGlmIChyZXEucXVlcnkuaW5jbHVkZVJlbGF0aW9ucykge1xuICAgICAgICAgICAgICByZWxhdGlvblF1ZXJpZXMgPSB0aGlzLmdldFJlbGF0aW9uUXVlcmllcyhUQUJMRV9DT05GSUcsIHJlc3VsdHNbMF0uaWQpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZWxhdGlvblF1ZXJpZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICAgICAgcmVzdWx0c1swXSxcbiAgICAgICAgICAgICAgICAuLi5yZWxhdGlvblF1ZXJpZXMsXG4gICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICAgIHJlc3VsdHNbMF0sXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIH1cbiAgICAgICAgKS50aGVuKFxuICAgICAgICAgIHRoaXMubWVyZ2VSZWxhdGVkRGF0YVxuICAgICAgICApLnRoZW4oXG4gICAgICAgICAgYWRkVG9SZXNwb25zZShyZXMsICdyZXN1bHQnKVxuICAgICAgICApLnRoZW4oXG4gICAgICAgICAgbmV4dEFuZFJldHVybihuZXh0KVxuICAgICAgICApXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGluc2VydFJvdyhyZXE6IFJlcXVlc3QsIHJlczogSU1DUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbikge1xuICAgIGlmICghZGF0YWJhc2UuZGIpIHtcbiAgICAgIHJldHVybiBjYXRjaE1pZGRsZXdhcmUobmV4dCkobmV3IEh0dHBFeGNlcHRpb24oNTAwLCAnTm8gZGF0YWJhc2UnKSlcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGRhdGFiYXNlLmRiKHJlcS5wYXJhbXMudGFibGUpLmluc2VydChyZXEuYm9keS5kYXRhKS50aGVuKFxuICAgICAgICBhZGRUb1Jlc3BvbnNlKHJlcywgJ3Jlc3VsdHMnKVxuICAgICAgKS50aGVuKFxuICAgICAgICBuZXh0QW5kUmV0dXJuKG5leHQpXG4gICAgICApXG4gICAgfVxuICB9XG5cbiAgcHVibGljIHVwZGF0ZVJvdyhyZXE6IFJlcXVlc3QsIHJlczogSU1DUmVzcG9uc2UsIG5leHQ6IE5leHRGdW5jdGlvbikge1xuICAgIGlmICghZGF0YWJhc2UuZGIpIHtcbiAgICAgIHJldHVybiBjYXRjaE1pZGRsZXdhcmUobmV4dCkobmV3IEh0dHBFeGNlcHRpb24oNTAwLCAnTm8gZGF0YWJhc2UnKSlcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGRhdGFiYXNlLmRiKHJlcS5ib2R5LnRhYmxlKS53aGVyZSgnaWQnLCByZXEuYm9keS5pZCkudXBkYXRlKHJlcS5ib2R5LmRhdGEpLnRoZW4oXG4gICAgICAgIGFkZFRvUmVzcG9uc2UocmVzLCAncmVzdWx0cycpXG4gICAgICApLnRoZW4oXG4gICAgICAgIG5leHRBbmRSZXR1cm4obmV4dClcbiAgICAgIClcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgZGVsZXRlUm93KHJlcTogUmVxdWVzdCwgcmVzOiBJTUNSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSB7XG4gICAgaWYgKCFkYXRhYmFzZS5kYikge1xuICAgICAgcmV0dXJuIGNhdGNoTWlkZGxld2FyZShuZXh0KShuZXcgSHR0cEV4Y2VwdGlvbig1MDAsICdObyBkYXRhYmFzZScpKVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZGF0YWJhc2UuZGIocmVxLnBhcmFtcy50YWJsZSkud2hlcmUoJ2lkJywgcmVxLnBhcmFtcy5pZCkuZGVsKCkudGhlbihcbiAgICAgICAgYWRkVG9SZXNwb25zZShyZXMsICdyZXN1bHRzJylcbiAgICAgICkudGhlbihcbiAgICAgICAgbmV4dEFuZFJldHVybihuZXh0KVxuICAgICAgKVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0UmVsYXRpb25RdWVyaWVzKFRBQkxFX0NPTkZJRzogSVRhYmxlSW5mbywgcGFyZW50SWQ6IGFueSkge1xuICAgIGNvbnN0IHJlbGF0aW9uUXVlcmllczogQXJyYXk8Qmx1ZWJpcmQ8e30+PiA9IFtdXG4gICAgaWYgKFRBQkxFX0NPTkZJRy5yZWxhdGlvbnMgJiYgVEFCTEVfQ09ORklHLnJlbGF0aW9ucy5tYW55VG9PbmUpIHtcbiAgICAgIGNvbnN0IE1BTllfVE9fT05FID0gVEFCTEVfQ09ORklHLnJlbGF0aW9ucy5tYW55VG9PbmVcbiAgICAgIGNvbnN0IEtFWVM6IHN0cmluZ1tdID0gT2JqZWN0LmtleXMoTUFOWV9UT19PTkUpXG4gICAgICBLRVlTLmZvckVhY2goXG4gICAgICAgICh0YWJsZU5hbWUpID0+IHtcbiAgICAgICAgICByZWxhdGlvblF1ZXJpZXMucHVzaChcbiAgICAgICAgICAgIHRoaXMuZ2V0UmVsYXRlZFJvdyhcbiAgICAgICAgICAgICAgdGFibGVOYW1lLFxuICAgICAgICAgICAgICBNQU5ZX1RPX09ORVt0YWJsZU5hbWVdLFxuICAgICAgICAgICAgICBwYXJlbnRJZFxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIHJldHVybiByZWxhdGlvblF1ZXJpZXNcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UmVsYXRlZFJvdyh0YWJsZU5hbWU6IHN0cmluZywgY29sdW1uTmFtZTogc3RyaW5nLCBwYXJlbnRJZDogYW55KSB7XG4gICAgaWYgKCFkYXRhYmFzZS5kYikge1xuICAgICAgdGhyb3cgbmV3IEh0dHBFeGNlcHRpb24oNTAwLCAnTm8gZGF0YWJhc2UnKVxuICAgIH1cbiAgICBjb25zdCBUQUJMRV9OQU1FID0gdGFibGVOYW1lXG4gICAgY29uc3QgVEFCTEVfQ09ORklHID0gZ2V0VGFibGVDb25maWcoVEFCTEVfTkFNRSlcblxuICAgIGNvbnN0IHJlcXVlc3RlZENvbHVtbnMgPSBmaWx0ZXJWaXNpYmxlVGFibGVDb2x1bW5zKFRBQkxFX0NPTkZJRywgJ2RldGFpbCcpXG4gICAgcmV0dXJuIGRhdGFiYXNlLmRiLnNlbGVjdChyZXF1ZXN0ZWRDb2x1bW5zKVxuICAgICAgLmZyb20odGFibGVOYW1lKVxuICAgICAgLndoZXJlKGNvbHVtbk5hbWUsIHBhcmVudElkKS50aGVuKFxuICAgICAgICAocmVzdWx0cykgPT4gKHtcbiAgICAgICAgICByZXN1bHRzLFxuICAgICAgICAgIHRhYmxlTmFtZSxcbiAgICAgICAgfSlcbiAgICAgIClcbiAgfVxuXG4gIHByaXZhdGUgbWVyZ2VSZWxhdGVkRGF0YShbcmVzdWx0cywgLi4ucmVsYXRpb25zXTogYW55KSB7XG4gICAgaWYgKHJlbGF0aW9ucyAmJiByZWxhdGlvbnMubGVuZ3RoKSB7XG4gICAgICByZWxhdGlvbnMuZm9yRWFjaChcbiAgICAgICAgKHJlbGF0aW9uOiB7dGFibGVOYW1lOiBzdHJpbmcsIHJlc3VsdHM6IGFueVtdfSkgPT4ge1xuICAgICAgICAgIHJlc3VsdHNbcmVsYXRpb24udGFibGVOYW1lXSA9IHJlbGF0aW9uLnJlc3VsdHNcbiAgICAgICAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgVGFibGVDb250cm9sbGVyXG4iXX0=