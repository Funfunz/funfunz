"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.setConfig = setConfig;
exports.default = _default;

var _configSchema = _interopRequireDefault(require("./configSchema"));

var _settingsSchema = _interopRequireDefault(require("./settingsSchema"));

var _jsonschema = require("jsonschema");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var config = {
  settings: [],
  config: {}
  /**
   * Normalize a port into a number, string, or false.
   */

};

function normalizePort(val) {
  var port = parseInt(val, 10);

  if (isNaN(port)) {
    // named pipe
    return val;
  }

  if (port >= 0) {
    // port number
    return port;
  }

  return false;
}

function setConfig(configs, target) {
  if (configCheck(configs, target)) {
    if (config.server && config.server.port) {
      config.server.port = normalizePort(config.server.port);
    }

    config[target] = configs;
  }
}

function configCheck(configs, target) {
  var validator = new _jsonschema.Validator();

  if (!configs && configs !== false) {
    throw new Error('Configuration is missing');
  }

  if (target === 'settings') {
    var validation = validator.validate(configs, _settingsSchema.default);

    if (validation.errors.length > 0) {
      console.log(validation.errors);
      throw new Error(validation.errors.toString());
    }
  }

  if (target === 'config') {
    var _validation = validator.validate(configs, _configSchema.default);

    if (_validation.errors.length > 0) {
      throw new Error(_validation.errors.toString());
    }
  }

  return true;
}

function _default() {
  return config;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcGkvdXRpbHMvY29uZmlnTG9hZGVyLnRzIl0sIm5hbWVzIjpbImNvbmZpZyIsInNldHRpbmdzIiwibm9ybWFsaXplUG9ydCIsInZhbCIsInBvcnQiLCJwYXJzZUludCIsImlzTmFOIiwic2V0Q29uZmlnIiwiY29uZmlncyIsInRhcmdldCIsImNvbmZpZ0NoZWNrIiwic2VydmVyIiwidmFsaWRhdG9yIiwiVmFsaWRhdG9yIiwiRXJyb3IiLCJ2YWxpZGF0aW9uIiwidmFsaWRhdGUiLCJzZXR0aW5nc1NjaGVtYSIsImVycm9ycyIsImxlbmd0aCIsImNvbnNvbGUiLCJsb2ciLCJ0b1N0cmluZyIsImNvbmZpZ1NjaGVtYSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQTs7OztBQUVBLElBQU1BLE1BSUwsR0FBRztBQUNGQyxFQUFBQSxRQUFRLEVBQUUsRUFEUjtBQUVGRCxFQUFBQSxNQUFNLEVBQUU7QUFHVjs7OztBQUxJLENBSko7O0FBWUEsU0FBU0UsYUFBVCxDQUF1QkMsR0FBdkIsRUFBb0M7QUFDbEMsTUFBTUMsSUFBSSxHQUFHQyxRQUFRLENBQUNGLEdBQUQsRUFBTSxFQUFOLENBQXJCOztBQUVBLE1BQUlHLEtBQUssQ0FBQ0YsSUFBRCxDQUFULEVBQWlCO0FBQ2Y7QUFDQSxXQUFPRCxHQUFQO0FBQ0Q7O0FBRUQsTUFBSUMsSUFBSSxJQUFJLENBQVosRUFBZTtBQUNiO0FBQ0EsV0FBT0EsSUFBUDtBQUNEOztBQUVELFNBQU8sS0FBUDtBQUNEOztBQUVNLFNBQVNHLFNBQVQsQ0FBbUJDLE9BQW5CLEVBQWlDQyxNQUFqQyxFQUFpRDtBQUN0RCxNQUFJQyxXQUFXLENBQUNGLE9BQUQsRUFBVUMsTUFBVixDQUFmLEVBQWtDO0FBQ2hDLFFBQUlULE1BQU0sQ0FBQ1csTUFBUCxJQUFpQlgsTUFBTSxDQUFDVyxNQUFQLENBQWNQLElBQW5DLEVBQXlDO0FBQ3ZDSixNQUFBQSxNQUFNLENBQUNXLE1BQVAsQ0FBY1AsSUFBZCxHQUFxQkYsYUFBYSxDQUFDRixNQUFNLENBQUNXLE1BQVAsQ0FBY1AsSUFBZixDQUFsQztBQUNEOztBQUNESixJQUFBQSxNQUFNLENBQUNTLE1BQUQsQ0FBTixHQUFpQkQsT0FBakI7QUFDRDtBQUNGOztBQUVELFNBQVNFLFdBQVQsQ0FBcUJGLE9BQXJCLEVBQW1DQyxNQUFuQyxFQUFtRDtBQUNqRCxNQUFNRyxTQUFTLEdBQUcsSUFBSUMscUJBQUosRUFBbEI7O0FBRUEsTUFBSSxDQUFDTCxPQUFELElBQVlBLE9BQU8sS0FBSyxLQUE1QixFQUFtQztBQUNqQyxVQUFNLElBQUlNLEtBQUosQ0FBVSwwQkFBVixDQUFOO0FBQ0Q7O0FBQ0QsTUFBSUwsTUFBTSxLQUFLLFVBQWYsRUFBMkI7QUFDekIsUUFBTU0sVUFBVSxHQUFHSCxTQUFTLENBQUNJLFFBQVYsQ0FBbUJSLE9BQW5CLEVBQTRCUyx1QkFBNUIsQ0FBbkI7O0FBQ0EsUUFBSUYsVUFBVSxDQUFDRyxNQUFYLENBQWtCQyxNQUFsQixHQUEyQixDQUEvQixFQUFrQztBQUNoQ0MsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlOLFVBQVUsQ0FBQ0csTUFBdkI7QUFDQSxZQUFNLElBQUlKLEtBQUosQ0FBVUMsVUFBVSxDQUFDRyxNQUFYLENBQWtCSSxRQUFsQixFQUFWLENBQU47QUFDRDtBQUNGOztBQUNELE1BQUliLE1BQU0sS0FBSyxRQUFmLEVBQXlCO0FBQ3ZCLFFBQU1NLFdBQVUsR0FBR0gsU0FBUyxDQUFDSSxRQUFWLENBQW1CUixPQUFuQixFQUE0QmUscUJBQTVCLENBQW5COztBQUNBLFFBQUlSLFdBQVUsQ0FBQ0csTUFBWCxDQUFrQkMsTUFBbEIsR0FBMkIsQ0FBL0IsRUFBa0M7QUFDaEMsWUFBTSxJQUFJTCxLQUFKLENBQVVDLFdBQVUsQ0FBQ0csTUFBWCxDQUFrQkksUUFBbEIsRUFBVixDQUFOO0FBQ0Q7QUFDRjs7QUFDRCxTQUFPLElBQVA7QUFDRDs7QUFFYyxvQkFBVztBQUN4QixTQUFPdEIsTUFBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNvbmZpZ1NjaGVtYSBmcm9tICdAcm9vdC9hcGkvdXRpbHMvY29uZmlnU2NoZW1hJ1xuaW1wb3J0IHNldHRpbmdzU2NoZW1hIGZyb20gJ0Byb290L2FwaS91dGlscy9zZXR0aW5nc1NjaGVtYSdcbmltcG9ydCB7IElUYWJsZUluZm8gfSBmcm9tICdAcm9vdC9jb25maWdHZW5lcmF0b3InXG5pbXBvcnQgeyBWYWxpZGF0b3IgfSBmcm9tICdqc29uc2NoZW1hJ1xuXG5jb25zdCBjb25maWc6IHtcbiAgc2V0dGluZ3M6IElUYWJsZUluZm9bXSxcbiAgY29uZmlnOiBhbnksXG4gIFtrZXk6IHN0cmluZ106IGFueSxcbn0gPSB7XG4gIHNldHRpbmdzOiBbXSxcbiAgY29uZmlnOiB7fSxcbn1cblxuLyoqXG4gKiBOb3JtYWxpemUgYSBwb3J0IGludG8gYSBudW1iZXIsIHN0cmluZywgb3IgZmFsc2UuXG4gKi9cbmZ1bmN0aW9uIG5vcm1hbGl6ZVBvcnQodmFsOiBzdHJpbmcpIHtcbiAgY29uc3QgcG9ydCA9IHBhcnNlSW50KHZhbCwgMTApXG5cbiAgaWYgKGlzTmFOKHBvcnQpKSB7XG4gICAgLy8gbmFtZWQgcGlwZVxuICAgIHJldHVybiB2YWxcbiAgfVxuXG4gIGlmIChwb3J0ID49IDApIHtcbiAgICAvLyBwb3J0IG51bWJlclxuICAgIHJldHVybiBwb3J0XG4gIH1cblxuICByZXR1cm4gZmFsc2Vcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldENvbmZpZyhjb25maWdzOiBhbnksIHRhcmdldDogc3RyaW5nKSB7XG4gIGlmIChjb25maWdDaGVjayhjb25maWdzLCB0YXJnZXQpKSB7XG4gICAgaWYgKGNvbmZpZy5zZXJ2ZXIgJiYgY29uZmlnLnNlcnZlci5wb3J0KSB7XG4gICAgICBjb25maWcuc2VydmVyLnBvcnQgPSBub3JtYWxpemVQb3J0KGNvbmZpZy5zZXJ2ZXIucG9ydClcbiAgICB9XG4gICAgY29uZmlnW3RhcmdldF0gPSBjb25maWdzXG4gIH1cbn1cblxuZnVuY3Rpb24gY29uZmlnQ2hlY2soY29uZmlnczogYW55LCB0YXJnZXQ6IHN0cmluZykge1xuICBjb25zdCB2YWxpZGF0b3IgPSBuZXcgVmFsaWRhdG9yKCk7XG5cbiAgaWYgKCFjb25maWdzICYmIGNvbmZpZ3MgIT09IGZhbHNlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDb25maWd1cmF0aW9uIGlzIG1pc3NpbmcnKVxuICB9XG4gIGlmICh0YXJnZXQgPT09ICdzZXR0aW5ncycpIHtcbiAgICBjb25zdCB2YWxpZGF0aW9uID0gdmFsaWRhdG9yLnZhbGlkYXRlKGNvbmZpZ3MsIHNldHRpbmdzU2NoZW1hKVxuICAgIGlmICh2YWxpZGF0aW9uLmVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zb2xlLmxvZyh2YWxpZGF0aW9uLmVycm9ycylcbiAgICAgIHRocm93IG5ldyBFcnJvcih2YWxpZGF0aW9uLmVycm9ycy50b1N0cmluZygpKVxuICAgIH1cbiAgfVxuICBpZiAodGFyZ2V0ID09PSAnY29uZmlnJykge1xuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0b3IudmFsaWRhdGUoY29uZmlncywgY29uZmlnU2NoZW1hKVxuICAgIGlmICh2YWxpZGF0aW9uLmVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IodmFsaWRhdGlvbi5lcnJvcnMudG9TdHJpbmcoKSlcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWVcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24oKSB7XG4gIHJldHVybiBjb25maWdcbn1cbiJdfQ==