"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.generateSettings = generateSettings;
exports.generateConfig = generateConfig;

var _fs = _interopRequireDefault(require("fs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function buildTableInfo() {
  return {
    name: '',
    pk: '',
    columns: []
  };
}

function buildColumnInfo() {
  return {
    name: '',
    verbose: '',
    type: '',
    allowNull: true
  };
}

function generateSettings(DBData) {
  var resultData = [];
  DBData.forEach(function (tableData) {
    var table = buildTableInfo();
    var schema = tableData.schema;
    var describe = tableData.describe;
    console.log(schema);
    table.name = schema[0].TABLE_NAME;
    describe.forEach(function (column) {
      var columnData = buildColumnInfo();
      columnData.name = column.Field;
      columnData.verbose = column.Field;
      columnData.type = column.Type;
      columnData.allowNull = column.Null === 'NO' ? false : true;

      if (column.Key === 'PRI') {
        table.pk = column.Field;
      }

      tableData.schema.forEach(function (schema) {
        if (schema.COLUMN_NAME === column.Field) {
          columnData.relation = {
            type: 'oneToMany',
            table: schema.REFERENCED_TABLE_NAME || '',
            key: schema.REFERENCED_COLUMN_NAME || '',
            display: [schema.REFERENCED_COLUMN_NAME || '']
          };
        }
      });
      table.columns.push(columnData);
    });
    resultData.push(table);
  });

  _fs.default.writeFile('settings.json', JSON.stringify(resultData, null, 2), 'utf8', function (err) {
    if (err) {
      console.log('err', err);
    }
  });
}

function generateConfig(answers) {
  var _finalConfig;

  var finalConfig = (_finalConfig = {}, _defineProperty(_finalConfig, answers.DBType, {
    host: answers.DBHost,
    database: answers.DBName,
    user: answers.DBUser,
    password: answers.DBPassword
  }), _defineProperty(_finalConfig, "server", {
    port: 3004
  }), _finalConfig);

  _fs.default.writeFile('config.json', JSON.stringify(finalConfig, null, 2), 'utf8', function (err) {
    if (err) {
      console.log('err', err);
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb25maWdHZW5lcmF0b3IudHMiXSwibmFtZXMiOlsiYnVpbGRUYWJsZUluZm8iLCJuYW1lIiwicGsiLCJjb2x1bW5zIiwiYnVpbGRDb2x1bW5JbmZvIiwidmVyYm9zZSIsInR5cGUiLCJhbGxvd051bGwiLCJnZW5lcmF0ZVNldHRpbmdzIiwiREJEYXRhIiwicmVzdWx0RGF0YSIsImZvckVhY2giLCJ0YWJsZURhdGEiLCJ0YWJsZSIsInNjaGVtYSIsImRlc2NyaWJlIiwiY29uc29sZSIsImxvZyIsIlRBQkxFX05BTUUiLCJjb2x1bW4iLCJjb2x1bW5EYXRhIiwiRmllbGQiLCJUeXBlIiwiTnVsbCIsIktleSIsIkNPTFVNTl9OQU1FIiwicmVsYXRpb24iLCJSRUZFUkVOQ0VEX1RBQkxFX05BTUUiLCJrZXkiLCJSRUZFUkVOQ0VEX0NPTFVNTl9OQU1FIiwiZGlzcGxheSIsInB1c2giLCJmcyIsIndyaXRlRmlsZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnIiLCJnZW5lcmF0ZUNvbmZpZyIsImFuc3dlcnMiLCJmaW5hbENvbmZpZyIsIkRCVHlwZSIsImhvc3QiLCJEQkhvc3QiLCJkYXRhYmFzZSIsIkRCTmFtZSIsInVzZXIiLCJEQlVzZXIiLCJwYXNzd29yZCIsIkRCUGFzc3dvcmQiLCJwb3J0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7Ozs7QUF5QkEsU0FBU0EsY0FBVCxHQUFvQztBQUNsQyxTQUFPO0FBQ0xDLElBQUFBLElBQUksRUFBRSxFQUREO0FBRUxDLElBQUFBLEVBQUUsRUFBRSxFQUZDO0FBR0xDLElBQUFBLE9BQU8sRUFBRTtBQUhKLEdBQVA7QUFLRDs7QUFFRCxTQUFTQyxlQUFULEdBQXNDO0FBQ3BDLFNBQU87QUFDTEgsSUFBQUEsSUFBSSxFQUFFLEVBREQ7QUFFTEksSUFBQUEsT0FBTyxFQUFFLEVBRko7QUFHTEMsSUFBQUEsSUFBSSxFQUFFLEVBSEQ7QUFJTEMsSUFBQUEsU0FBUyxFQUFFO0FBSk4sR0FBUDtBQU1EOztB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QWIsRUFBNEJDLElBQUksQ0FBQ0MsU0FBTCxDQUFlSSxXQUFmLEVBQTRCLElBQTVCLEVBQWtDLENBQWxDLENBQTVCLEVBQWtFLE1BQWxFLEVBQTBFLFVBQUNILEdBQUQsRUFBUztBQUNqRixRQUFJQSxHQUFKLEVBQVM7QUFDUHBCLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLEtBQVosRUFBbUJtQixHQUFuQjtBQUNEO0FBQ0YsR0FKRDtBQUtEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gJ2ZzJ1xuaW1wb3J0IHsgZGVzY3JpYmVJbmZvLCBzY2hlbWFJbmZvIH0gZnJvbSAnQHJvb3QvZGVzY3JpYmVUYWJsZSdcbmltcG9ydCB7IHR5cGVBbnN3ZXJzIH0gZnJvbSAnQHJvb3QvaW5kZXgnXG5cbnR5cGUgdGFibGVJbmZvID0ge1xuICBuYW1lOiBzdHJpbmcsXG4gIHBrOiBzdHJpbmcsXG4gIGNvbHVtbnM6IEFycmF5PFxuICAgIGNvbHVtbkluZm9cbiAgPixcbn1cblxudHlwZSBjb2x1bW5JbmZvID0ge1xuICBuYW1lOiBzdHJpbmcsXG4gIHZlcmJvc2U6IHN0cmluZyxcbiAgdHlwZTogc3RyaW5nLFxuICBhbGxvd051bGw6IGJvb2xlYW4sXG4gIHJlbGF0aW9uPzoge1xuICAgIHR5cGU6IHN0cmluZyxcbiAgICB0YWJsZTogc3RyaW5nLFxuICAgIGtleTogc3RyaW5nLFxuICAgIGRpc3BsYXk6IEFycmF5PHN0cmluZz5cbiAgfVxufVxuXG5mdW5jdGlvbiBidWlsZFRhYmxlSW5mbygpOnRhYmxlSW5mbyB7XG4gIHJldHVybiB7XG4gICAgbmFtZTogJycsXG4gICAgcGs6ICcnLFxuICAgIGNvbHVtbnM6IFtdLFxuICB9XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQ29sdW1uSW5mbygpOmNvbHVtbkluZm8ge1xuICByZXR1cm4ge1xuICAgIG5hbWU6ICcnLFxuICAgIHZlcmJvc2U6ICcnLFxuICAgIHR5cGU6ICcnLFxuICAgIGFsbG93TnVsbDogdHJ1ZSxcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVTZXR0aW5ncyhEQkRhdGE6IEFycmF5PHtzY2hlbWE6IHNjaGVtYUluZm8sIGRlc2NyaWJlOiBkZXNjcmliZUluZm99Pik6YW55IHtcbiAgbGV0IHJlc3VsdERhdGE6IEFycmF5PGFueT4gPSBbXVxuICBEQkRhdGEuZm9yRWFjaChcbiAgICB0YWJsZURhdGEgPT4ge1xuICAgICAgbGV0IHRhYmxlID0gYnVpbGRUYWJsZUluZm8oKVxuICAgICAgY29uc3Qgc2NoZW1hID0gdGFibGVEYXRhLnNjaGVtYVxuICAgICAgY29uc3QgZGVzY3JpYmUgPSB0YWJsZURhdGEuZGVzY3JpYmVcbiAgICAgIGNvbnNvbGUubG9nKHNjaGVtYSlcbiAgICAgIHRhYmxlLm5hbWUgPSBzY2hlbWFbMF0uVEFCTEVfTkFNRVxuICAgICAgZGVzY3JpYmUuZm9yRWFjaChcbiAgICAgICAgKGNvbHVtbikgPT4ge1xuICAgICAgICAgIGxldCBjb2x1bW5EYXRhID0gYnVpbGRDb2x1bW5JbmZvKClcbiAgICAgICAgICBjb2x1bW5EYXRhLm5hbWUgPSBjb2x1bW4uRmllbGRcbiAgICAgICAgICBjb2x1bW5EYXRhLnZlcmJvc2UgPSBjb2x1bW4uRmllbGRcbiAgICAgICAgICBjb2x1bW5EYXRhLnR5cGUgPSBjb2x1bW4uVHlwZVxuICAgICAgICAgIGNvbHVtbkRhdGEuYWxsb3dOdWxsID0gY29sdW1uLk51bGwgPT09ICdOTycgPyBmYWxzZSA6IHRydWVcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoY29sdW1uLktleSA9PT0gJ1BSSScpIHtcbiAgICAgICAgICAgIHRhYmxlLnBrID0gY29sdW1uLkZpZWxkXG4gICAgICAgICAgfVxuICAgICAgICAgIHRhYmxlRGF0YS5zY2hlbWEuZm9yRWFjaChcbiAgICAgICAgICAgIChzY2hlbWEpID0+IHtcbiAgICAgICAgICAgICAgaWYgKHNjaGVtYS5DT0xVTU5fTkFNRSA9PT0gY29sdW1uLkZpZWxkKSB7XG4gICAgICAgICAgICAgICAgY29sdW1uRGF0YS5yZWxhdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdvbmVUb01hbnknLFxuICAgICAgICAgICAgICAgICAgdGFibGU6IHNjaGVtYS5SRUZFUkVOQ0VEX1RBQkxFX05BTUUgfHwgJycsXG4gICAgICAgICAgICAgICAgICBrZXk6IHNjaGVtYS5SRUZFUkVOQ0VEX0NPTFVNTl9OQU1FIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgZGlzcGxheTogW1xuICAgICAgICAgICAgICAgICAgICBzY2hlbWEuUkVGRVJFTkNFRF9DT0xVTU5fTkFNRSB8fCAnJ1xuICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIClcbiAgICAgICAgICBcbiAgICAgICAgICB0YWJsZS5jb2x1bW5zLnB1c2goY29sdW1uRGF0YSlcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgcmVzdWx0RGF0YS5wdXNoKHRhYmxlKVxuICAgIH1cbiAgKVxuICBmcy53cml0ZUZpbGUoJ3NldHRpbmdzLmpzb24nLCBKU09OLnN0cmluZ2lmeShyZXN1bHREYXRhLCBudWxsLCAyKSwgJ3V0ZjgnLCAoZXJyKSA9PiB7XG4gICAgaWYgKGVycikge1xuICAgICAgY29uc29sZS5sb2coJ2VycicsIGVycilcbiAgICB9XG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUNvbmZpZyhhbnN3ZXJzOiB0eXBlQW5zd2Vycykge1xuICBjb25zdCBmaW5hbENvbmZpZyA9IHtcbiAgICBbYW5zd2Vycy5EQlR5cGVdOiB7XG4gICAgICAgIGhvc3Q6IGFuc3dlcnMuREJIb3N0LFxuICAgICAgICBkYXRhYmFzZTogYW5zd2Vycy5EQk5hbWUsXG4gICAgICAgIHVzZXI6IGFuc3dlcnMuREJVc2VyLFxuICAgICAgICBwYXNzd29yZDogYW5zd2Vycy5EQlBhc3N3b3JkXG4gICAgfSxcbiAgICBzZXJ2ZXI6IHtcbiAgICAgICAgcG9ydDogMzAwNFxuICAgIH1cbiAgfVxuICBmcy53cml0ZUZpbGUoJ2NvbmZpZy5qc29uJywgSlNPTi5zdHJpbmdpZnkoZmluYWxDb25maWcsIG51bGwsIDIpLCAndXRmOCcsIChlcnIpID0+IHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBjb25zb2xlLmxvZygnZXJyJywgZXJyKVxuICAgIH1cbiAgfSlcbn0iXX0=