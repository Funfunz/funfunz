"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.generateSettings = generateSettings;
exports.generateConfig = generateConfig;

var _fs = _interopRequireDefault(require("fs"));

var _pluralize = _interopRequireDefault(require("pluralize"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function buildTableInfo() {
  return {
    name: '',
    verbose: '',
    pk: '',
    columns: [],
    visible: true,
    roles: ['all']
  };
}

function buildColumnInfo() {
  return {
    name: '',
    verbose: '',
    type: '',
    allowNull: true,
    visible: {
      main: true,
      detail: true
    },
    editable: true
  };
}

function generateSettings(DBData) {
  var resultData = [];
  DBData.forEach(function (tableData) {
    var table = buildTableInfo();
    var schema = tableData.schema;
    var describe = tableData.describe;
    console.log(schema[0]);
    table.name = schema[0].TABLE_NAME;
    var pluralName = (0, _pluralize.default)(table.name);
    table.verbose = pluralName.charAt(0).toUpperCase() + pluralName.slice(1);
    describe.forEach(function (column) {
      var columnData = buildColumnInfo();
      columnData.name = column.Field;
      columnData.verbose = column.Field;
      columnData.type = column.Type;
      columnData.allowNull = column.Null === 'NO' ? false : true;

      if (column.Key === 'PRI') {
        table.pk = column.Field;
      }

      tableData.schema.forEach(function (schemaData) {
        if (schemaData.COLUMN_NAME === column.Field) {
          columnData.relation = {
            type: 'oneToMany',
            table: schemaData.REFERENCED_TABLE_NAME || '',
            key: schemaData.REFERENCED_COLUMN_NAME || '',
            display: [schemaData.REFERENCED_COLUMN_NAME || '']
          };
        }
      });
      table.columns.push(columnData);
    });
    resultData.push(table);
  });

  _fs.default.writeFile('settings.json', JSON.stringify(resultData, null, 2), 'utf8', function (err) {
    if (err) {
      console.log('err', err);
    }
  });
}

function generateConfig(answers) {
  var _finalConfig;

  var finalConfig = (_finalConfig = {}, _defineProperty(_finalConfig, answers.DBType, {
    host: answers.DBHost,
    database: answers.DBName,
    user: answers.DBUser,
    password: answers.DBPassword
  }), _defineProperty(_finalConfig, "server", {
    port: 3004
  }), _finalConfig);

  _fs.default.writeFile('config.json', JSON.stringify(finalConfig, null, 2), 'utf8', function (err) {
    if (err) {
      console.log('err', err);
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb25maWdHZW5lcmF0b3IudHMiXSwibmFtZXMiOlsiYnVpbGRUYWJsZUluZm8iLCJuYW1lIiwidmVyYm9zZSIsInBrIiwiY29sdW1ucyIsInZpc2libGUiLCJyb2xlcyIsImJ1aWxkQ29sdW1uSW5mbyIsInR5cGUiLCJhbGxvd051bGwiLCJtYWluIiwiZGV0YWlsIiwiZWRpdGFibGUiLCJnZW5lcmF0ZVNldHRpbmdzIiwiREJEYXRhIiwicmVzdWx0RGF0YSIsImZvckVhY2giLCJ0YWJsZURhdGEiLCJ0YWJsZSIsInNjaGVtYSIsImRlc2NyaWJlIiwiY29uc29sZSIsImxvZyIsIlRBQkxFX05BTUUiLCJwbHVyYWxOYW1lIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsImNvbHVtbiIsImNvbHVtbkRhdGEiLCJGaWVsZCIsIlR5cGUiLCJOdWxsIiwiS2V5Iiwic2NoZW1hRGF0YSIsIkNPTFVNTl9OQU1FIiwicmVsYXRpb24iLCJSRUZFUkVOQ0VEX1RBQkxFX05BTUUiLCJrZXkiLCJSRUZFUkVOQ0VEX0NPTFVNTl9OQU1FIiwiZGlzcGxheSIsInB1c2giLCJmcyIsIndyaXRlRmlsZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnIiLCJnZW5lcmF0ZUNvbmZpZyIsImFuc3dlcnMiLCJmaW5hbENvbmZpZyIsIkRCVHlwZSIsImhvc3QiLCJEQkhvc3QiLCJkYXRhYmFzZSIsIkRCTmFtZSIsInVzZXIiLCJEQlVzZXIiLCJwYXNzd29yZCIsIkRCUGFzc3dvcmQiLCJwb3J0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUdBOztBQUVBOzs7Ozs7QUErQ0EsU0FBU0EsY0FBVCxHQUFzQztBQUNwQyxTQUFPO0FBQ0xDLElBQUFBLElBQUksRUFBRSxFQUREO0FBRUxDLElBQUFBLE9BQU8sRUFBRSxFQUZKO0FBR0xDLElBQUFBLEVBQUUsRUFBRSxFQUhDO0FBSUxDLElBQUFBLE9BQU8sRUFBRSxFQUpKO0FBS0xDLElBQUFBLE9BQU8sRUFBRSxJQUxKO0FB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SUFBSSxDQUFDQyxTQUFMLENBQWU5QixVQUFmLEVBQTJCLElBQTNCLEVBQWlDLENBQWpDLENBQTlCLEVBQW1FLE1BQW5FLEVBQTJFLFVBQUMrQixHQUFELEVBQVM7QUFDbEYsUUFBSUEsR0FBSixFQUFTO0FBQ1B6QixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxLQUFaLEVBQW1Cd0IsR0FBbkI7QUFDRDtBQUNGLEdBSkQ7QUFLRDs7QUFFTSxTQUFTQyxjQUFULENBQXdCQyxPQUF4QixFQUErQztBQUFBOztBQUNwRCxNQUFNQyxXQUFXLHFEQUNkRCxPQUFPLENBQUNFLE1BRE0sRUFDRztBQUNkQyxJQUFBQSxJQUFJLEVBQUVILE9BQU8sQ0FBQ0ksTUFEQTtBQUVkQyxJQUFBQSxRQUFRLEVBQUVMLE9BQU8sQ0FBQ00sTUFGSjtBQUdkQyxJQUFBQSxJQUFJLEVBQUVQLE9BQU8sQ0FBQ1EsTUFIQTtBQUlkQyxJQUFBQSxRQUFRLEVBQUVULE9BQU8sQ0FBQ1U7QUFKSixHQURILDJDQU9QO0FBQ0pDLElBQUFBLElBQUksRUFBRTtBQURGLEdBUE8sZ0JBQWpCOztBQVdBakIsY0FBR0MsU0FBSCxDQUFhLGFBQWIsRUFBNEJDLElBQUksQ0FBQ0MsU0FBTCxDQUFlSSxXQUFmLEVBQTRCLElBQTVCLEVBQWtDLENBQWxDLENBQTVCLEVBQWtFLE1BQWxFLEVBQTBFLFVBQUNILEdBQUQsRUFBUztBQUNqRixRQUFJQSxHQUFKLEVBQVM7QUFDUHpCLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLEtBQVosRUFBbUJ3QixHQUFuQjtBQUNEO0FBQ0YsR0FKRDtBQUtEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmVJbmZvLCBzY2hlbWFJbmZvIH0gZnJvbSAnQHJvb3QvZGVzY3JpYmVUYWJsZSdcbmltcG9ydCB7IElUeXBlQW5zd2VycyB9IGZyb20gJ0Byb290L2luZGV4J1xuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcydcbmltcG9ydCBmcyBmcm9tICdmcydcbmltcG9ydCBrbmV4IGZyb20gJ2tuZXgnXG5pbXBvcnQgcGx1cmFsaXplIGZyb20gJ3BsdXJhbGl6ZSdcblxudHlwZSBJSG9va0Z1bmN0aW9uID0gKFxuICByZXE6IGV4cHJlc3MuUmVxdWVzdCxcbiAgcmVzOiBleHByZXNzLlJlc3BvbnNlLFxuICBEQjoga25leCxcbiAgdGFibGVOYW1lOiBzdHJpbmcsXG4gIGRhdGE6IGFueVxuKSA9PiBQcm9taXNlIDxhbnk+XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVRhYmxlSW5mbyB7XG4gIG5hbWU6IHN0cmluZyxcbiAgdmVyYm9zZTogc3RyaW5nLFxuICBwazogc3RyaW5nLFxuICBjb2x1bW5zOiBJQ29sdW1uSW5mb1tdLFxuICB2aXNpYmxlOiBib29sZWFuLFxuICByb2xlczogc3RyaW5nW10sXG4gIGhvb2tzPzoge1xuICAgIGdldFRhYmxlRGF0YT86IHtcbiAgICAgIGJlZm9yZT86IElIb29rRnVuY3Rpb25cbiAgICAgIGFmdGVyPzogSUhvb2tGdW5jdGlvblxuICAgIH0sXG4gICAgZ2V0VGFibGVDb3VudD86IHtcbiAgICAgIGJlZm9yZT86IElIb29rRnVuY3Rpb25cbiAgICAgIGFmdGVyPzogSUhvb2tGdW5jdGlvblxuICAgIH1cbiAgfVxufVxuXG5pbnRlcmZhY2UgSUNvbHVtbkluZm8ge1xuICBuYW1lOiBzdHJpbmcsXG4gIHZlcmJvc2U6IHN0cmluZyxcbiAgdHlwZTogc3RyaW5nLFxuICBhbGxvd051bGw6IGJvb2xlYW4sXG4gIHZpc2libGU6IHtcbiAgICBtYWluOiBib29sZWFuLFxuICAgIGRldGFpbDogYm9vbGVhbixcbiAgfSxcbiAgZWRpdGFibGU6IGJvb2xlYW4sXG4gIHJlbGF0aW9uPzoge1xuICAgIHR5cGU6IHN0cmluZyxcbiAgICB0YWJsZTogc3RyaW5nLFxuICAgIGtleTogc3RyaW5nLFxuICAgIGRpc3BsYXk6IHN0cmluZ1tdLFxuICB9LFxufVxuXG5mdW5jdGlvbiBidWlsZFRhYmxlSW5mbygpOiBJVGFibGVJbmZvIHtcbiAgcmV0dXJuIHtcbiAgICBuYW1lOiAnJyxcbiAgICB2ZXJib3NlOiAnJyxcbiAgICBwazogJycsXG4gICAgY29sdW1uczogW10sXG4gICAgdmlzaWJsZTogdHJ1ZSxcbiAgICByb2xlczogWydhbGwnXSxcbiAgfVxufVxuXG5mdW5jdGlvbiBidWlsZENvbHVtbkluZm8oKTogSUNvbHVtbkluZm8ge1xuICByZXR1cm4ge1xuICAgIG5hbWU6ICcnLFxuICAgIHZlcmJvc2U6ICcnLFxuICAgIHR5cGU6ICcnLFxuICAgIGFsbG93TnVsbDogdHJ1ZSxcbiAgICB2aXNpYmxlOiB7XG4gICAgICBtYWluOiB0cnVlLFxuICAgICAgZGV0YWlsOiB0cnVlLFxuICAgIH0sXG4gICAgZWRpdGFibGU6IHRydWUsXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlU2V0dGluZ3MoREJEYXRhOiBBcnJheTx7c2NoZW1hOiBzY2hlbWFJbmZvLCBkZXNjcmliZTogZGVzY3JpYmVJbmZvfT4pOiBhbnkge1xuICBjb25zdCByZXN1bHREYXRhOiBhbnlbXSA9IFtdXG4gIERCRGF0YS5mb3JFYWNoKFxuICAgICh0YWJsZURhdGEpID0+IHtcbiAgICAgIGNvbnN0IHRhYmxlID0gYnVpbGRUYWJsZUluZm8oKVxuICAgICAgY29uc3Qgc2NoZW1hID0gdGFibGVEYXRhLnNjaGVtYVxuICAgICAgY29uc3QgZGVzY3JpYmUgPSB0YWJsZURhdGEuZGVzY3JpYmVcbiAgICAgIGNvbnNvbGUubG9nKHNjaGVtYVswXSlcbiAgICAgIHRhYmxlLm5hbWUgPSBzY2hlbWFbMF0uVEFCTEVfTkFNRVxuXG4gICAgICBjb25zdCBwbHVyYWxOYW1lID0gcGx1cmFsaXplKHRhYmxlLm5hbWUpXG5cbiAgICAgIHRhYmxlLnZlcmJvc2UgPSBwbHVyYWxOYW1lLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcGx1cmFsTmFtZS5zbGljZSgxKVxuICAgICAgZGVzY3JpYmUuZm9yRWFjaChcbiAgICAgICAgKGNvbHVtbikgPT4ge1xuICAgICAgICAgIGNvbnN0IGNvbHVtbkRhdGEgPSBidWlsZENvbHVtbkluZm8oKVxuICAgICAgICAgIGNvbHVtbkRhdGEubmFtZSA9IGNvbHVtbi5GaWVsZFxuICAgICAgICAgIGNvbHVtbkRhdGEudmVyYm9zZSA9IGNvbHVtbi5GaWVsZFxuICAgICAgICAgIGNvbHVtbkRhdGEudHlwZSA9IGNvbHVtbi5UeXBlXG4gICAgICAgICAgY29sdW1uRGF0YS5hbGxvd051bGwgPSBjb2x1bW4uTnVsbCA9PT0gJ05PJyA/IGZhbHNlIDogdHJ1ZVxuXG4gICAgICAgICAgaWYgKGNvbHVtbi5LZXkgPT09ICdQUkknKSB7XG4gICAgICAgICAgICB0YWJsZS5wayA9IGNvbHVtbi5GaWVsZFxuICAgICAgICAgIH1cbiAgICAgICAgICB0YWJsZURhdGEuc2NoZW1hLmZvckVhY2goXG4gICAgICAgICAgICAoc2NoZW1hRGF0YSkgPT4ge1xuICAgICAgICAgICAgICBpZiAoc2NoZW1hRGF0YS5DT0xVTU5fTkFNRSA9PT0gY29sdW1uLkZpZWxkKSB7XG4gICAgICAgICAgICAgICAgY29sdW1uRGF0YS5yZWxhdGlvbiA9IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdvbmVUb01hbnknLFxuICAgICAgICAgICAgICAgICAgdGFibGU6IHNjaGVtYURhdGEuUkVGRVJFTkNFRF9UQUJMRV9OQU1FIHx8ICcnLFxuICAgICAgICAgICAgICAgICAga2V5OiBzY2hlbWFEYXRhLlJFRkVSRU5DRURfQ09MVU1OX05BTUUgfHwgJycsXG4gICAgICAgICAgICAgICAgICBkaXNwbGF5OiBbXG4gICAgICAgICAgICAgICAgICAgIHNjaGVtYURhdGEuUkVGRVJFTkNFRF9DT0xVTU5fTkFNRSB8fCAnJyxcbiAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgKVxuXG4gICAgICAgICAgdGFibGUuY29sdW1ucy5wdXNoKGNvbHVtbkRhdGEpXG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIHJlc3VsdERhdGEucHVzaCh0YWJsZSlcbiAgICB9XG4gIClcbiAgZnMud3JpdGVGaWxlKCdzZXR0aW5ncy5qc29uJywgSlNPTi5zdHJpbmdpZnkocmVzdWx0RGF0YSwgbnVsbCwgMiksICd1dGY4JywgKGVycikgPT4ge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdlcnInLCBlcnIpXG4gICAgfVxuICB9KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVDb25maWcoYW5zd2VyczogSVR5cGVBbnN3ZXJzKSB7XG4gIGNvbnN0IGZpbmFsQ29uZmlnID0ge1xuICAgIFthbnN3ZXJzLkRCVHlwZV06IHtcbiAgICAgICAgaG9zdDogYW5zd2Vycy5EQkhvc3QsXG4gICAgICAgIGRhdGFiYXNlOiBhbnN3ZXJzLkRCTmFtZSxcbiAgICAgICAgdXNlcjogYW5zd2Vycy5EQlVzZXIsXG4gICAgICAgIHBhc3N3b3JkOiBhbnN3ZXJzLkRCUGFzc3dvcmQsXG4gICAgfSxcbiAgICBzZXJ2ZXI6IHtcbiAgICAgICAgcG9ydDogMzAwNCxcbiAgICB9LFxuICB9XG4gIGZzLndyaXRlRmlsZSgnY29uZmlnLmpzb24nLCBKU09OLnN0cmluZ2lmeShmaW5hbENvbmZpZywgbnVsbCwgMiksICd1dGY4JywgKGVycikgPT4ge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdlcnInLCBlcnIpXG4gICAgfVxuICB9KVxufVxuIl19