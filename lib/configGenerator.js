"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.generateSettings = generateSettings;
exports.generateConfig = generateConfig;

var _fs = _interopRequireDefault(require("fs"));

var _pluralize = _interopRequireDefault(require("pluralize"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function buildTableInfo() {
  return {
    name: '',
    verbose: '',
    pk: '',
    columns: [],
    visible: true,
    roles: ['all']
  };
}

function buildColumnInfo() {
  return {
    name: '',
    verbose: '',
    type: '',
    allowNull: true,
    visible: {
      main: true,
      detail: true
    },
    editable: true
  };
}

function generateSettings(DBData) {
  var resultData = [];
  DBData.forEach(function (tableData) {
    var table = buildTableInfo();
    var schema = tableData.schema;
    var describe = tableData.describe;
    table.name = schema[0].TABLE_NAME;
    var pluralName = (0, _pluralize.default)(table.name);
    table.verbose = pluralName.charAt(0).toUpperCase() + pluralName.slice(1);
    describe.forEach(function (column) {
      var columnData = buildColumnInfo();
      columnData.name = column.Field;
      columnData.verbose = column.Field;
      columnData.type = column.Type;
      columnData.allowNull = column.Null === 'NO' ? false : true;

      if (column.Key === 'PRI') {
        table.pk = column.Field;
      }

      tableData.schema.forEach(function (schemaData) {
        if (schemaData.COLUMN_NAME === column.Field) {
          columnData.relation = {
            type: 'oneToMany',
            table: schemaData.REFERENCED_TABLE_NAME || '',
            key: schemaData.REFERENCED_COLUMN_NAME || '',
            display: schemaData.REFERENCED_COLUMN_NAME || ''
          };
        }
      });
      table.columns.push(columnData);
    });
    resultData.push(table);
  });

  _fs.default.writeFile('settings.json', JSON.stringify(resultData, null, 2), 'utf8', function (err) {
    if (err) {
      console.log('err', err);
    }
  });
}

function generateConfig(answers) {
  var _finalConfig;

  var finalConfig = (_finalConfig = {}, _defineProperty(_finalConfig, answers.DBType, {
    host: answers.DBHost,
    database: answers.DBName,
    user: answers.DBUser,
    password: answers.DBPassword
  }), _defineProperty(_finalConfig, "server", {
    port: 3004
  }), _finalConfig);

  _fs.default.writeFile('config.json', JSON.stringify(finalConfig, null, 2), 'utf8', function (err) {
    if (err) {
      console.log('err', err);
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb25maWdHZW5lcmF0b3IudHMiXSwibmFtZXMiOlsiYnVpbGRUYWJsZUluZm8iLCJuYW1lIiwidmVyYm9zZSIsInBrIiwiY29sdW1ucyIsInZpc2libGUiLCJyb2xlcyIsImJ1aWxkQ29sdW1uSW5mbyIsInR5cGUiLCJhbGxvd051bGwiLCJtYWluIiwiZGV0YWlsIiwiZWRpdGFibGUiLCJnZW5lcmF0ZVNldHRpbmdzIiwiREJEYXRhIiwicmVzdWx0RGF0YSIsImZvckVhY2giLCJ0YWJsZURhdGEiLCJ0YWJsZSIsInNjaGVtYSIsImRlc2NyaWJlIiwiVEFCTEVfTkFNRSIsInBsdXJhbE5hbWUiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwiY29sdW1uIiwiY29sdW1uRGF0YSIsIkZpZWxkIiwiVHlwZSIsIk51bGwiLCJLZXkiLCJzY2hlbWFEYXRhIiwiQ09MVU1OX05BTUUiLCJyZWxhdGlvbiIsIlJFRkVSRU5DRURfVEFCTEVfTkFNRSIsImtleSIsIlJFRkVSRU5DRURfQ09MVU1OX05BTUUiLCJkaXNwbGF5IiwicHVzaCIsImZzIiwid3JpdGVGaWxlIiwiSlNPTiIsInN0cmluZ2lmeSIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJnZW5lcmF0ZUNvbmZpZyIsImFuc3dlcnMiLCJmaW5hbENvbmZpZyIsIkRCVHlwZSIsImhvc3QiLCJEQkhvc3QiLCJkYXRhYmFzZSIsIkRCTmFtZSIsInVzZXIiLCJEQlVzZXIiLCJwYXNzd29yZCIsIkRCUGFzc3dvcmQiLCJwb3J0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUdBOztBQUVBOzs7Ozs7QUF5REEsU0FBU0EsY0FBVCxHQUFzQztBQUNwQyxTQUFPO0FBQ0xDLElBQUFBLElBQUksRUFBRSxFQUREO0FBRUxDLElBQUFBLE9BQU8sRUFBRSxFQUZKO0FBR0xDLElBQUFBLEVBQUUsRUFBRSxFQUhDO0FBSUxDLElBQUFBLE9BQU8sRUFBRSxFQUpKO0FBS0xDLElBQUFBLE9BQU8sRUFBRSxJQUxKO0FBTUxDLElBQUFBLEtBQUssRUFBRSxDQUFDLEtBQUQ7QUFORixHQUFQO0FBUUQ7O0FBRUQsU0FBU0MsZUFBVCxHQUF3QztBQUN0QyxTQUFPO0FBQ0xOLElBQUFBLElBQUksRUFBRSxFQUREO0FBRUxDLElBQUFBLE9BQU8sRUFBRSxFQUZKO0FBR0xNLElBQUFBLElBQUksRUFBRSxFQUhEO0FBSUxDLElBQUFBLFNBQVMsRUFBRSxJQUpOO0FBS0xKLElBQUFBLE9BQU8sRUFBRTtBQUNQSyxNQUFBQSxJQUFJLEVBQUUsSUFEQztBQUVQQyxNQUFBQSxNQUFNLEVBQUU7QUFGRCxLQUxKO0FBU0xDLElBQUFBLFFBQVEsRUFBRTtBQVRMLEdBQVA7QUFXRDs7QUFFTSxTQUFTQyxnQkFBVCxDQUEwQkMsTUFBMUIsRUFBNEY7QUFDakcsTUFBTUMsVUFBaUIsR0FBRyxFQUExQjtBQUNBRCxFQUFBQSxNQUFNLENBQUNFLE9BQVAsQ0FDRSxVQUFDQyxTQUFELEVBQWU7QUFDYixRQUFNQyxLQUFLLEdBQUdsQixjQUFjLEVBQTVCO0FBQ0EsUUFBTW1CLE1BQU0sR0FBR0YsU0FBUyxDQUFDRSxNQUF6QjtBQUNBLFFBQU1DLFFBQVEsR0FBR0gsU0FBUyxDQUFDRyxRQUEzQjtBQUNBRixJQUFBQSxLQUFLLENBQUNqQixJQUFOLEdBQWFrQixNQUFNLENBQUMsQ0FBRCxDQUFOLENBQVVFLFVBQXZCO0FBRUEsUUFBTUMsVUFBVSxHQUFHLHdCQUFVSixLQUFLLENBQUNqQixJQUFoQixDQUFuQjtBQUVBaUIsSUFBQUEsS0FBSyxDQUFDaEIsT0FBTixHQUFnQm9CLFVBQVUsQ0FBQ0MsTUFBWCxDQUFrQixDQUFsQixFQUFxQkMsV0FBckIsS0FBcUNGLFVBQVUsQ0FBQ0csS0FBWCxDQUFpQixDQUFqQixDQUFyRDtBQUNBTCxJQUFBQSxRQUFRLENBQUNKLE9BQVQsQ0FDRSxVQUFDVSxNQUFELEVBQVk7QUFDVixVQUFNQyxVQUFVLEdBQUdwQixlQUFlLEVBQWxDO0FBQ0FvQixNQUFBQSxVQUFVLENBQUMxQixJQUFYLEdBQWtCeUIsTUFBTSxDQUFDRSxLQUF6QjtBQUNBRCxNQUFBQSxVQUFVLENBQUN6QixPQUFYLEdBQXFCd0IsTUFBTSxDQUFDRSxLQUE1QjtBQUNBRCxNQUFBQSxVQUFVLENBQUNuQixJQUFYLEdBQWtCa0IsTUFBTSxDQUFDRyxJQUF6QjtBQUNBRixNQUFBQSxVQUFVLENBQUNsQixTQUFYLEdBQXVCaUIsTUFBTSxDQUFDSSxJQUFQLEtBQWdCLElBQWhCLEdBQXVCLEtBQXZCLEdBQStCLElBQXREOztBQUVBLFVBQUlKLE1BQU0sQ0FBQ0ssR0FBUCxLQUFlLEtBQW5CLEVBQTBCO0FBQ3hCYixRQUFBQSxLQUFLLENBQUNmLEVBQU4sR0FBV3VCLE1BQU0sQ0FBQ0UsS0FBbEI7QUFDRDs7QUFDRFgsTUFBQUEsU0FBUyxDQUFDRSxNQUFWLENBQWlCSCxPQUFqQixDQUNFLFVBQUNnQixVQUFELEVBQWdCO0FBQ2QsWUFBSUEsVUFBVSxDQUFDQyxXQUFYLEtBQTJCUCxNQUFNLENBQUNFLEtBQXRDLEVBQTZDO0FBQzNDRCxVQUFBQSxVQUFVLENBQUNPLFFBQVgsR0FBc0I7QUFDcEIxQixZQUFBQSxJQUFJLEVBQUUsV0FEYztBQUVwQlUsWUFBQUEsS0FBSyxFQUFFYyxVQUFVLENBQUNHLHFCQUFYLElBQW9DLEVBRnZCO0FBR3BCQyxZQUFBQSxHQUFHLEVBQUVKLFVBQVUsQ0FBQ0ssc0JBQVgsSUFBcUMsRUFIdEI7QUFJcEJDLFlBQUFBLE9BQU8sRUFBRU4sVUFBVSxDQUFDSyxzQkFBWCxJQUFxQztBQUoxQixXQUF0QjtBQU1EO0FBQ0YsT0FWSDtBQWFBbkIsTUFBQUEsS0FBSyxDQUFDZCxPQUFOLENBQWNtQyxJQUFkLENBQW1CWixVQUFuQjtBQUNELEtBekJIO0FBMkJBWixJQUFBQSxVQUFVLENBQUN3QixJQUFYLENBQWdCckIsS0FBaEI7QUFDRCxHQXRDSDs7QUF3Q0FzQixjQUFHQyxTQUFILENBQWEsZUFBYixFQUE4QkMsSUFBSSxDQUFDQyxTQUFMLENBQWU1QixVQUFmLEVBQTJCLElBQTNCLEVBQWlDLENBQWpDLENBQTlCLEVBQW1FLE1BQW5FLEVBQTJFLFVBQUM2QixHQUFELEVBQVM7QUFDbEYsUUFBSUEsR0FBSixFQUFTO0FBQ1BDLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLEtBQVosRUFBbUJGLEdBQW5CO0FBQ0Q7QUFDRixHQUpEO0FBS0Q7O0FBRU0sU0FBU0csY0FBVCxDQUF3QkMsT0FBeEIsRUFBK0M7QUFBQTs7QUFDcEQsTUFBTUMsV0FBVyxxREFDZEQsT0FBTyxDQUFDRSxNQURNLEVBQ0c7QUFDZEMsSUFBQUEsSUFBSSxFQUFFSCxPQUFPLENBQUNJLE1BREE7QUFFZEMsSUFBQUEsUUFBUSxFQUFFTCxPQUFPLENBQUNNLE1BRko7QUFHZEMsSUFBQUEsSUFBSSxFQUFFUCxPQUFPLENBQUNRLE1BSEE7QUFJZEMsSUFBQUEsUUFBUSxFQUFFVCxPQUFPLENBQUNVO0FBSkosR0FESCwyQ0FPUDtBQUNKQyxJQUFBQSxJQUFJLEVBQUU7QUFERixHQVBPLGdCQUFqQjs7QUFXQW5CLGNBQUdDLFNBQUgsQ0FBYSxhQUFiLEVBQTRCQyxJQUFJLENBQUNDLFNBQUwsQ0FBZU0sV0FBZixFQUE0QixJQUE1QixFQUFrQyxDQUFsQyxDQUE1QixFQUFrRSxNQUFsRSxFQUEwRSxVQUFDTCxHQUFELEVBQVM7QUFDakYsUUFBSUEsR0FBSixFQUFTO0FBQ1BDLE1BQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLEtBQVosRUFBbUJGLEdBQW5CO0FBQ0Q7QUFDRixHQUpEO0FBS0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZXNjcmliZUluZm8sIHNjaGVtYUluZm8gfSBmcm9tICdAcm9vdC9kZXNjcmliZVRhYmxlJ1xuaW1wb3J0IHsgSVR5cGVBbnN3ZXJzIH0gZnJvbSAnQHJvb3QvaW5kZXgnXG5pbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJ1xuaW1wb3J0IGZzIGZyb20gJ2ZzJ1xuaW1wb3J0IGtuZXggZnJvbSAna25leCdcbmltcG9ydCBwbHVyYWxpemUgZnJvbSAncGx1cmFsaXplJ1xuXG50eXBlIElIb29rRnVuY3Rpb24gPSAoXG4gIHJlcTogZXhwcmVzcy5SZXF1ZXN0LFxuICByZXM6IGV4cHJlc3MuUmVzcG9uc2UsXG4gIERCOiBrbmV4LFxuICB0YWJsZU5hbWU6IHN0cmluZyxcbiAgZGF0YT86IGFueVxuKSA9PiBQcm9taXNlIDxhbnk+XG5cbmV4cG9ydCB0eXBlIEhvb2tzID0gJ2dldFRhYmxlRGF0YScgfCAnZ2V0VGFibGVDb3VudCdcblxuZXhwb3J0IGludGVyZmFjZSBJVGFibGVJbmZvIHtcbiAgbmFtZTogc3RyaW5nLFxuICB2ZXJib3NlOiBzdHJpbmcsXG4gIHBrOiBzdHJpbmcsXG4gIHNlYXJjaEZpZWxkcz86IHN0cmluZ1tdLFxuICByZWxhdGlvbnM/OiB7XG4gICAgbWFueVRvT25lPzoge1xuICAgICAgW2tleTogc3RyaW5nXTogc3RyaW5nLFxuICAgIH1cbiAgfVxuICBjb2x1bW5zOiBJQ29sdW1uSW5mb1tdLFxuICB2aXNpYmxlOiBib29sZWFuLFxuICByb2xlczogc3RyaW5nW10sXG4gIGhvb2tzPzoge1xuICAgIGdldFRhYmxlRGF0YT86IHtcbiAgICAgIGJlZm9yZT86IElIb29rRnVuY3Rpb25cbiAgICAgIGFmdGVyPzogSUhvb2tGdW5jdGlvblxuICAgIH0sXG4gICAgZ2V0VGFibGVDb3VudD86IHtcbiAgICAgIGJlZm9yZT86IElIb29rRnVuY3Rpb25cbiAgICAgIGFmdGVyPzogSUhvb2tGdW5jdGlvblxuICAgIH0sXG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJQ29sdW1uUmVsYXRpb24ge1xuICB0eXBlOiBzdHJpbmcsXG4gIHRhYmxlOiBzdHJpbmcsXG4gIGtleTogc3RyaW5nLFxuICBkaXNwbGF5OiBzdHJpbmcsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUNvbHVtbkluZm8ge1xuICBuYW1lOiBzdHJpbmcsXG4gIHZlcmJvc2U6IHN0cmluZyxcbiAgdHlwZTogc3RyaW5nLFxuICBhbGxvd051bGw6IGJvb2xlYW4sXG4gIHZpc2libGU6IHtcbiAgICBtYWluOiBib29sZWFuLFxuICAgIGRldGFpbDogYm9vbGVhbixcbiAgfSxcbiAgZWRpdGFibGU6IGJvb2xlYW4sXG4gIHJlbGF0aW9uPzogSUNvbHVtblJlbGF0aW9uXG59XG5cbmZ1bmN0aW9uIGJ1aWxkVGFibGVJbmZvKCk6IElUYWJsZUluZm8ge1xuICByZXR1cm4ge1xuICAgIG5hbWU6ICcnLFxuICAgIHZlcmJvc2U6ICcnLFxuICAgIHBrOiAnJyxcbiAgICBjb2x1bW5zOiBbXSxcbiAgICB2aXNpYmxlOiB0cnVlLFxuICAgIHJvbGVzOiBbJ2FsbCddLFxuICB9XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQ29sdW1uSW5mbygpOiBJQ29sdW1uSW5mbyB7XG4gIHJldHVybiB7XG4gICAgbmFtZTogJycsXG4gICAgdmVyYm9zZTogJycsXG4gICAgdHlwZTogJycsXG4gICAgYWxsb3dOdWxsOiB0cnVlLFxuICAgIHZpc2libGU6IHtcbiAgICAgIG1haW46IHRydWUsXG4gICAgICBkZXRhaWw6IHRydWUsXG4gICAgfSxcbiAgICBlZGl0YWJsZTogdHJ1ZSxcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVTZXR0aW5ncyhEQkRhdGE6IEFycmF5PHtzY2hlbWE6IHNjaGVtYUluZm8sIGRlc2NyaWJlOiBkZXNjcmliZUluZm99Pik6IGFueSB7XG4gIGNvbnN0IHJlc3VsdERhdGE6IGFueVtdID0gW11cbiAgREJEYXRhLmZvckVhY2goXG4gICAgKHRhYmxlRGF0YSkgPT4ge1xuICAgICAgY29uc3QgdGFibGUgPSBidWlsZFRhYmxlSW5mbygpXG4gICAgICBjb25zdCBzY2hlbWEgPSB0YWJsZURhdGEuc2NoZW1hXG4gICAgICBjb25zdCBkZXNjcmliZSA9IHRhYmxlRGF0YS5kZXNjcmliZVxuICAgICAgdGFibGUubmFtZSA9IHNjaGVtYVswXS5UQUJMRV9OQU1FXG5cbiAgICAgIGNvbnN0IHBsdXJhbE5hbWUgPSBwbHVyYWxpemUodGFibGUubmFtZSlcblxuICAgICAgdGFibGUudmVyYm9zZSA9IHBsdXJhbE5hbWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBwbHVyYWxOYW1lLnNsaWNlKDEpXG4gICAgICBkZXNjcmliZS5mb3JFYWNoKFxuICAgICAgICAoY29sdW1uKSA9PiB7XG4gICAgICAgICAgY29uc3QgY29sdW1uRGF0YSA9IGJ1aWxkQ29sdW1uSW5mbygpXG4gICAgICAgICAgY29sdW1uRGF0YS5uYW1lID0gY29sdW1uLkZpZWxkXG4gICAgICAgICAgY29sdW1uRGF0YS52ZXJib3NlID0gY29sdW1uLkZpZWxkXG4gICAgICAgICAgY29sdW1uRGF0YS50eXBlID0gY29sdW1uLlR5cGVcbiAgICAgICAgICBjb2x1bW5EYXRhLmFsbG93TnVsbCA9IGNvbHVtbi5OdWxsID09PSAnTk8nID8gZmFsc2UgOiB0cnVlXG5cbiAgICAgICAgICBpZiAoY29sdW1uLktleSA9PT0gJ1BSSScpIHtcbiAgICAgICAgICAgIHRhYmxlLnBrID0gY29sdW1uLkZpZWxkXG4gICAgICAgICAgfVxuICAgICAgICAgIHRhYmxlRGF0YS5zY2hlbWEuZm9yRWFjaChcbiAgICAgICAgICAgIChzY2hlbWFEYXRhKSA9PiB7XG4gICAgICAgICAgICAgIGlmIChzY2hlbWFEYXRhLkNPTFVNTl9OQU1FID09PSBjb2x1bW4uRmllbGQpIHtcbiAgICAgICAgICAgICAgICBjb2x1bW5EYXRhLnJlbGF0aW9uID0ge1xuICAgICAgICAgICAgICAgICAgdHlwZTogJ29uZVRvTWFueScsXG4gICAgICAgICAgICAgICAgICB0YWJsZTogc2NoZW1hRGF0YS5SRUZFUkVOQ0VEX1RBQkxFX05BTUUgfHwgJycsXG4gICAgICAgICAgICAgICAgICBrZXk6IHNjaGVtYURhdGEuUkVGRVJFTkNFRF9DT0xVTU5fTkFNRSB8fCAnJyxcbiAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IHNjaGVtYURhdGEuUkVGRVJFTkNFRF9DT0xVTU5fTkFNRSB8fCAnJyxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICApXG5cbiAgICAgICAgICB0YWJsZS5jb2x1bW5zLnB1c2goY29sdW1uRGF0YSlcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgcmVzdWx0RGF0YS5wdXNoKHRhYmxlKVxuICAgIH1cbiAgKVxuICBmcy53cml0ZUZpbGUoJ3NldHRpbmdzLmpzb24nLCBKU09OLnN0cmluZ2lmeShyZXN1bHREYXRhLCBudWxsLCAyKSwgJ3V0ZjgnLCAoZXJyKSA9PiB7XG4gICAgaWYgKGVycikge1xuICAgICAgY29uc29sZS5sb2coJ2VycicsIGVycilcbiAgICB9XG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZUNvbmZpZyhhbnN3ZXJzOiBJVHlwZUFuc3dlcnMpIHtcbiAgY29uc3QgZmluYWxDb25maWcgPSB7XG4gICAgW2Fuc3dlcnMuREJUeXBlXToge1xuICAgICAgICBob3N0OiBhbnN3ZXJzLkRCSG9zdCxcbiAgICAgICAgZGF0YWJhc2U6IGFuc3dlcnMuREJOYW1lLFxuICAgICAgICB1c2VyOiBhbnN3ZXJzLkRCVXNlcixcbiAgICAgICAgcGFzc3dvcmQ6IGFuc3dlcnMuREJQYXNzd29yZCxcbiAgICB9LFxuICAgIHNlcnZlcjoge1xuICAgICAgICBwb3J0OiAzMDA0LFxuICAgIH0sXG4gIH1cbiAgZnMud3JpdGVGaWxlKCdjb25maWcuanNvbicsIEpTT04uc3RyaW5naWZ5KGZpbmFsQ29uZmlnLCBudWxsLCAyKSwgJ3V0ZjgnLCAoZXJyKSA9PiB7XG4gICAgaWYgKGVycikge1xuICAgICAgY29uc29sZS5sb2coJ2VycicsIGVycilcbiAgICB9XG4gIH0pXG59XG4iXX0=