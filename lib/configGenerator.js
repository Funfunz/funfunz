"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.generateSettings = generateSettings;
exports.generateConfig = generateConfig;

var _debug = _interopRequireDefault(require("debug"));

var _fs = _interopRequireDefault(require("fs"));

var _pluralize = _interopRequireDefault(require("pluralize"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var debug = (0, _debug.default)('funfunzmc:config-generator');

function buildTableInfo() {
  return {
    name: '',
    verbose: '',
    pk: '',
    columns: [],
    visible: true,
    roles: ['all']
  };
}

function buildColumnInfo() {
  return {
    name: '',
    verbose: '',
    type: '',
    allowNull: true,
    visible: {
      main: true,
      detail: true
    },
    editable: true
  };
}

function generateSettings(DBData) {
  var resultData = [];
  DBData.forEach(function (tableData) {
    var table = buildTableInfo();
    var schema = tableData.schema;
    var describe = tableData.describe;
    table.name = schema[0].TABLE_NAME;
    var pluralName = (0, _pluralize.default)(table.name);
    table.verbose = pluralName.charAt(0).toUpperCase() + pluralName.slice(1);
    describe.forEach(function (column) {
      var columnData = buildColumnInfo();
      columnData.name = column.Field;
      columnData.verbose = column.Field;
      columnData.type = column.Type;
      columnData.allowNull = column.Null === 'NO' ? false : true;

      if (column.Key === 'PRI') {
        table.pk = column.Field;
      }

      tableData.schema.forEach(function (schemaData) {
        if (schemaData.COLUMN_NAME === column.Field) {
          columnData.relation = {
            type: 'oneToMany',
            table: schemaData.REFERENCED_TABLE_NAME || '',
            key: schemaData.REFERENCED_COLUMN_NAME || '',
            display: schemaData.REFERENCED_COLUMN_NAME || ''
          };
        }
      });
      table.columns.push(columnData);
    });

    _fs.default.writeFile('generatedConfigs/models/' + table.name + '.js', 'export default ' + JSON.stringify(table, null, 2), 'utf8', function (err) {
      if (err) {
        debug('err' + JSON.stringify(err));
      }
    });

    resultData.push(table);
  });

  _fs.default.writeFile('generatedConfigs/MCsettings.js', resultData.map(function (table) {
    return "import ".concat(table.name, "Model from './models/").concat(table.name, "'\n");
  }).join('') + '\nexport default [\n' + resultData.map(function (table) {
    return "  ".concat(table.name, "Model,\n");
  }).join('') + ']\n', 'utf8', function (err) {
    if (err) {
      debug('err' + JSON.stringify(err));
    }
  });
}

function generateConfig(answers) {
  var _finalConfig;

  var finalConfig = (_finalConfig = {}, _defineProperty(_finalConfig, answers.DBType, {
    host: answers.DBHost,
    database: answers.DBName,
    user: answers.DBUser,
    password: answers.DBPassword
  }), _defineProperty(_finalConfig, "server", {
    port: 3004
  }), _finalConfig);

  _fs.default.writeFile('generatedConfigs/MCconfig.js', 'export default ' + JSON.stringify(finalConfig, null, 2), 'utf8', function (err) {
    if (err) {
      debug('err' + JSON.stringify(err));
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb25maWdHZW5lcmF0b3IudHMiXSwibmFtZXMiOlsiZGVidWciLCJidWlsZFRhYmxlSW5mbyIsIm5hbWUiLCJ2ZXJib3NlIiwicGsiLCJjb2x1bW5zIiwidmlzaWJsZSIsInJvbGVzIiwiYnVpbGRDb2x1bW5JbmZvIiwidHlwZSIsImFsbG93TnVsbCIsIm1haW4iLCJkZXRhaWwiLCJlZGl0YWJsZSIsImdlbmVyYXRlU2V0dGluZ3MiLCJEQkRhdGEiLCJyZXN1bHREYXRhIiwiZm9yRWFjaCIsInRhYmxlRGF0YSIsInRhYmxlIiwic2NoZW1hIiwiZGVzY3JpYmUiLCJUQUJMRV9OQU1FIiwicGx1cmFsTmFtZSIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJjb2x1bW4iLCJjb2x1bW5EYXRhIiwiRmllbGQiLCJUeXBlIiwiTnVsbCIsIktleSIsInNjaGVtYURhdGEiLCJDT0xVTU5fTkFNRSIsInJlbGF0aW9uIiwiUkVGRVJFTkNFRF9UQUJMRV9OQU1FIiwia2V5IiwiUkVGRVJFTkNFRF9DT0xVTU5fTkFNRSIsImRpc3BsYXkiLCJwdXNoIiwiZnMiLCJ3cml0ZUZpbGUiLCJKU09OIiwic3RyaW5naWZ5IiwiZXJyIiwibWFwIiwiam9pbiIsImdlbmVyYXRlQ29uZmlnIiwiYW5zd2VycyIsImZpbmFsQ29uZmlnIiwiREJUeXBlIiwiaG9zdCIsIkRCSG9zdCIsImRhdGFiYXNlIiwiREJOYW1lIiwidXNlciIsIkRCVXNlciIsInBhc3N3b3JkIiwiREJQYXNzd29yZCIsInBvcnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBRUE7O0FBRUE7O0FBRUE7Ozs7OztBQUVBLElBQU1BLEtBQUssR0FBRyxvQkFBTSw0QkFBTixDQUFkOztBQXFGQSxTQUFTQyxjQUFULEdBQXNDO0FBQ3BDLFNBQU87QUFDTEMsSUFBQUEsSUFBSSxFQUFFLEVBREQ7QUFFTEMsSUFBQUEsT0FBTyxFQUFFLEVBRko7QUFHTEMsSUFBQUEsRUFBRSxFQUFFLEVBSEM7QUFJTEMs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Q0FPUDtBQUNKQyxJQUFBQSxJQUFJLEVBQUU7QUFERixHQVBPLGdCQUFqQjs7QUFXQW5CLGNBQUdDLFNBQUgsQ0FDRSw4QkFERixFQUVFLG9CQUFvQkMsSUFBSSxDQUFDQyxTQUFMLENBQWVNLFdBQWYsRUFBNEIsSUFBNUIsRUFBa0MsQ0FBbEMsQ0FGdEIsRUFHRSxNQUhGLEVBSUUsVUFBQ0wsR0FBRCxFQUFTO0FBQ1AsUUFBSUEsR0FBSixFQUFTO0FBQ1A3QyxNQUFBQSxLQUFLLENBQUMsUUFBUTJDLElBQUksQ0FBQ0MsU0FBTCxDQUFlQyxHQUFmLENBQVQsQ0FBTDtBQUNEO0FBQ0YsR0FSSDtBQVVEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmVJbmZvLCBzY2hlbWFJbmZvIH0gZnJvbSAnQHJvb3QvZGVzY3JpYmVUYWJsZSdcbmltcG9ydCB7IElUeXBlQW5zd2VycyB9IGZyb20gJ0Byb290L2luZGV4J1xuaW1wb3J0IERlYnVnIGZyb20gJ2RlYnVnJ1xuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcydcbmltcG9ydCBmcyBmcm9tICdmcydcbmltcG9ydCBrbmV4IGZyb20gJ2tuZXgnXG5pbXBvcnQgcGx1cmFsaXplIGZyb20gJ3BsdXJhbGl6ZSdcblxuY29uc3QgZGVidWcgPSBEZWJ1ZygnZnVuZnVuem1jOmNvbmZpZy1nZW5lcmF0b3InKVxuXG50eXBlIElIb29rRnVuY3Rpb24gPSAoXG4gIHJlcTogZXhwcmVzcy5SZXF1ZXN0LFxuICByZXM6IGV4cHJlc3MuUmVzcG9uc2UsXG4gIERCOiBrbmV4LFxuICB0YWJsZU5hbWU6IHN0cmluZyxcbiAgZGF0YT86IGFueVxuKSA9PiBQcm9taXNlIDxhbnk+XG5cbmV4cG9ydCB0eXBlIEhvb2tzID0gJ2dldFRhYmxlRGF0YScgfCAnZ2V0VGFibGVDb3VudCcgfCAnZ2V0Um93JyB8ICdpbnNlcnRSb3cnIHwgJ3VwZGF0ZVJvdycgfCAnZGVsZXRlUm93J1xuXG5leHBvcnQgaW50ZXJmYWNlIElUYWJsZUluZm8ge1xuICBuYW1lOiBzdHJpbmcsXG4gIHZlcmJvc2U6IHN0cmluZyxcbiAgcGs6IHN0cmluZyxcbiAgc2VhcmNoRmllbGRzPzogc3RyaW5nW10sXG4gIHJlbGF0aW9ucz86IHtcbiAgICBtYW55VG9PbmU/OiB7XG4gICAgICBba2V5OiBzdHJpbmddOiBzdHJpbmcsXG4gICAgfSxcbiAgfSxcbiAgY2hpcHM/OiBbXG4gICAge1xuICAgICAgdmVyYm9zZTogc3RyaW5nLFxuICAgICAgY29sdW1uczogW1xuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogc3RyaW5nLFxuICAgICAgICAgIHZlcmJvc2U6IHN0cmluZyxcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICB9LFxuICBdLFxuICBpdGVtVGl0bGU/OiBzdHJpbmcsXG4gIGNvbHVtbnM6IElDb2x1bW5JbmZvW10sXG4gIHZpc2libGU6IGJvb2xlYW4sXG4gIHJvbGVzOiBzdHJpbmdbXSxcbiAgaG9va3M/OiB7XG4gICAgZ2V0VGFibGVEYXRhPzoge1xuICAgICAgYmVmb3JlPzogSUhvb2tGdW5jdGlvbixcbiAgICAgIGFmdGVyPzogSUhvb2tGdW5jdGlvbixcbiAgICB9LFxuICAgIGdldFRhYmxlQ291bnQ/OiB7XG4gICAgICBiZWZvcmU/OiBJSG9va0Z1bmN0aW9uLFxuICAgICAgYWZ0ZXI/OiBJSG9va0Z1bmN0aW9uLFxuICAgIH0sXG4gICAgZ2V0Um93Pzoge1xuICAgICAgYmVmb3JlPzogSUhvb2tGdW5jdGlvbixcbiAgICAgIGFmdGVyPzogSUhvb2tGdW5jdGlvbixcbiAgICB9LFxuICAgIGluc2VydFJvdz86IHtcbiAgICAgIGJlZm9yZT86IElIb29rRnVuY3Rpb24sXG4gICAgICBhZnRlcj86IElIb29rRnVuY3Rpb24sXG4gICAgfSxcbiAgICB1cGRhdGVSb3c/OiB7XG4gICAgICBiZWZvcmU/OiBJSG9va0Z1bmN0aW9uLFxuICAgICAgYWZ0ZXI/OiBJSG9va0Z1bmN0aW9uLFxuICAgIH0sXG4gICAgZGVsZXRlUm93Pzoge1xuICAgICAgYmVmb3JlPzogSUhvb2tGdW5jdGlvbixcbiAgICAgIGFmdGVyPzogSUhvb2tGdW5jdGlvbixcbiAgICB9LFxuICB9LFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElDb2x1bW5SZWxhdGlvbiB7XG4gIHR5cGU6IHN0cmluZyxcbiAgdGFibGU6IHN0cmluZyxcbiAga2V5OiBzdHJpbmcsXG4gIGRpc3BsYXk6IHN0cmluZyxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJQ29sdW1uSW5mbyB7XG4gIG5hbWU6IHN0cmluZyxcbiAgdmVyYm9zZTogc3RyaW5nLFxuICB0eXBlOiBzdHJpbmcsXG4gIGFsbG93TnVsbDogYm9vbGVhbixcbiAgdmlzaWJsZToge1xuICAgIG1haW46IGJvb2xlYW4sXG4gICAgZGV0YWlsOiBib29sZWFuLFxuICB9LFxuICBlZGl0YWJsZTogYm9vbGVhbixcbiAgcmVsYXRpb24/OiBJQ29sdW1uUmVsYXRpb25cbn1cblxuZnVuY3Rpb24gYnVpbGRUYWJsZUluZm8oKTogSVRhYmxlSW5mbyB7XG4gIHJldHVybiB7XG4gICAgbmFtZTogJycsXG4gICAgdmVyYm9zZTogJycsXG4gICAgcGs6ICcnLFxuICAgIGNvbHVtbnM6IFtdLFxuICAgIHZpc2libGU6IHRydWUsXG4gICAgcm9sZXM6IFsnYWxsJ10sXG4gIH1cbn1cblxuZnVuY3Rpb24gYnVpbGRDb2x1bW5JbmZvKCk6IElDb2x1bW5JbmZvIHtcbiAgcmV0dXJuIHtcbiAgICBuYW1lOiAnJyxcbiAgICB2ZXJib3NlOiAnJyxcbiAgICB0eXBlOiAnJyxcbiAgICBhbGxvd051bGw6IHRydWUsXG4gICAgdmlzaWJsZToge1xuICAgICAgbWFpbjogdHJ1ZSxcbiAgICAgIGRldGFpbDogdHJ1ZSxcbiAgICB9LFxuICAgIGVkaXRhYmxlOiB0cnVlLFxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVNldHRpbmdzKERCRGF0YTogQXJyYXk8e3NjaGVtYTogc2NoZW1hSW5mbywgZGVzY3JpYmU6IGRlc2NyaWJlSW5mb30+KTogYW55IHtcbiAgY29uc3QgcmVzdWx0RGF0YTogYW55W10gPSBbXVxuICBEQkRhdGEuZm9yRWFjaChcbiAgICAodGFibGVEYXRhKSA9PiB7XG4gICAgICBjb25zdCB0YWJsZSA9IGJ1aWxkVGFibGVJbmZvKClcbiAgICAgIGNvbnN0IHNjaGVtYSA9IHRhYmxlRGF0YS5zY2hlbWFcbiAgICAgIGNvbnN0IGRlc2NyaWJlID0gdGFibGVEYXRhLmRlc2NyaWJlXG4gICAgICB0YWJsZS5uYW1lID0gc2NoZW1hWzBdLlRBQkxFX05BTUVcblxuICAgICAgY29uc3QgcGx1cmFsTmFtZSA9IHBsdXJhbGl6ZSh0YWJsZS5uYW1lKVxuXG4gICAgICB0YWJsZS52ZXJib3NlID0gcGx1cmFsTmFtZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHBsdXJhbE5hbWUuc2xpY2UoMSlcbiAgICAgIGRlc2NyaWJlLmZvckVhY2goXG4gICAgICAgIChjb2x1bW4pID0+IHtcbiAgICAgICAgICBjb25zdCBjb2x1bW5EYXRhID0gYnVpbGRDb2x1bW5JbmZvKClcbiAgICAgICAgICBjb2x1bW5EYXRhLm5hbWUgPSBjb2x1bW4uRmllbGRcbiAgICAgICAgICBjb2x1bW5EYXRhLnZlcmJvc2UgPSBjb2x1bW4uRmllbGRcbiAgICAgICAgICBjb2x1bW5EYXRhLnR5cGUgPSBjb2x1bW4uVHlwZVxuICAgICAgICAgIGNvbHVtbkRhdGEuYWxsb3dOdWxsID0gY29sdW1uLk51bGwgPT09ICdOTycgPyBmYWxzZSA6IHRydWVcblxuICAgICAgICAgIGlmIChjb2x1bW4uS2V5ID09PSAnUFJJJykge1xuICAgICAgICAgICAgdGFibGUucGsgPSBjb2x1bW4uRmllbGRcbiAgICAgICAgICB9XG4gICAgICAgICAgdGFibGVEYXRhLnNjaGVtYS5mb3JFYWNoKFxuICAgICAgICAgICAgKHNjaGVtYURhdGEpID0+IHtcbiAgICAgICAgICAgICAgaWYgKHNjaGVtYURhdGEuQ09MVU1OX05BTUUgPT09IGNvbHVtbi5GaWVsZCkge1xuICAgICAgICAgICAgICAgIGNvbHVtbkRhdGEucmVsYXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiAnb25lVG9NYW55JyxcbiAgICAgICAgICAgICAgICAgIHRhYmxlOiBzY2hlbWFEYXRhLlJFRkVSRU5DRURfVEFCTEVfTkFNRSB8fCAnJyxcbiAgICAgICAgICAgICAgICAgIGtleTogc2NoZW1hRGF0YS5SRUZFUkVOQ0VEX0NPTFVNTl9OQU1FIHx8ICcnLFxuICAgICAgICAgICAgICAgICAgZGlzcGxheTogc2NoZW1hRGF0YS5SRUZFUkVOQ0VEX0NPTFVNTl9OQU1FIHx8ICcnLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIClcblxuICAgICAgICAgIHRhYmxlLmNvbHVtbnMucHVzaChjb2x1bW5EYXRhKVxuICAgICAgICB9XG4gICAgICApXG4gICAgICBmcy53cml0ZUZpbGUoXG4gICAgICAgICdnZW5lcmF0ZWRDb25maWdzL21vZGVscy8nICsgdGFibGUubmFtZSArICcuanMnLFxuICAgICAgICAnZXhwb3J0IGRlZmF1bHQgJyArIEpTT04uc3RyaW5naWZ5KHRhYmxlLCBudWxsLCAyKSxcbiAgICAgICAgJ3V0ZjgnLFxuICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgZGVidWcoJ2VycicgKyBKU09OLnN0cmluZ2lmeShlcnIpKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgcmVzdWx0RGF0YS5wdXNoKHRhYmxlKVxuICAgIH1cbiAgKVxuXG4gIGZzLndyaXRlRmlsZShcbiAgICAnZ2VuZXJhdGVkQ29uZmlncy9NQ3NldHRpbmdzLmpzJyxcbiAgICByZXN1bHREYXRhLm1hcChcbiAgICAgICh0YWJsZSkgPT4gYGltcG9ydCAke3RhYmxlLm5hbWV9TW9kZWwgZnJvbSAnLi9tb2RlbHMvJHt0YWJsZS5uYW1lfSdcXG5gXG4gICAgKS5qb2luKCcnKSArXG4gICAgJ1xcbmV4cG9ydCBkZWZhdWx0IFtcXG4nICtcbiAgICByZXN1bHREYXRhLm1hcChcbiAgICAgICh0YWJsZSkgPT4gYCAgJHt0YWJsZS5uYW1lfU1vZGVsLFxcbmBcbiAgICApLmpvaW4oJycpICtcbiAgICAnXVxcbicsXG4gICAgJ3V0ZjgnLFxuICAgIChlcnIpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgZGVidWcoJ2VycicgKyBKU09OLnN0cmluZ2lmeShlcnIpKVxuICAgICAgfVxuICAgIH1cbiAgKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVDb25maWcoYW5zd2VyczogSVR5cGVBbnN3ZXJzKSB7XG4gIGNvbnN0IGZpbmFsQ29uZmlnID0ge1xuICAgIFthbnN3ZXJzLkRCVHlwZV06IHtcbiAgICAgICAgaG9zdDogYW5zd2Vycy5EQkhvc3QsXG4gICAgICAgIGRhdGFiYXNlOiBhbnN3ZXJzLkRCTmFtZSxcbiAgICAgICAgdXNlcjogYW5zd2Vycy5EQlVzZXIsXG4gICAgICAgIHBhc3N3b3JkOiBhbnN3ZXJzLkRCUGFzc3dvcmQsXG4gICAgfSxcbiAgICBzZXJ2ZXI6IHtcbiAgICAgICAgcG9ydDogMzAwNCxcbiAgICB9LFxuICB9XG4gIGZzLndyaXRlRmlsZShcbiAgICAnZ2VuZXJhdGVkQ29uZmlncy9NQ2NvbmZpZy5qcycsXG4gICAgJ2V4cG9ydCBkZWZhdWx0ICcgKyBKU09OLnN0cmluZ2lmeShmaW5hbENvbmZpZywgbnVsbCwgMiksXG4gICAgJ3V0ZjgnLFxuICAgIChlcnIpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgZGVidWcoJ2VycicgKyBKU09OLnN0cmluZ2lmeShlcnIpKVxuICAgICAgfVxuICAgIH1cbiAgKVxufVxuIl19